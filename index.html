<html>
<head>
  <title>Clicker</title>
  <meta charset="utf-8">
<script type="module">
    // Импорты Firebase
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js';
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js';
    import { getDatabase, ref, set, get, update, child } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js';

    // Конфигурация Firebase (замени на свои данные)
    const firebaseConfig = { 
  apiKey : «AIzaSyAlYasR91o2zMvD3OYYNFHdoyAAvfkiK80» , 
  authDomain : "spaceclicker-78ef5.firebaseapp.com" , 
  databaseURL : "https://spaceclicker-78ef5-default-rtdb.firebaseio.com" , 
  projectId : "spaceclicker-78ef5" , 
  storageBucket : "spaceclicker-78ef5.firebasestorage.app" , 
  messagingSenderId : "1007817982727" , 
  appId : "1:1007817982727:web:c653b6f656b017cbb73ba2" 
};

    // Инициализация Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    // Переменные
    let currentUid = null;
    let userData = null;
    let currentUsername = null;
    let isDemo = false;
    let demoUser = { count: 0, money: 0, level: 0, has_small_cookie: 0, equipped_small_cookie: 0, has_medium_cookie: 0, equipped_medium_cookie: 0, has_large_cookie: 0, equipped_large_cookie: 0, is_blocked: 0, achieved_100: 0, achieved_500: 0, achieved_1000: 0, achieved_3000: 0, achieved_5000: 0, achieved_10000: 0, active_quest: null, completed_quests: [] };
    let questStartTime = Date.now();
    let questClicks = 0;
    let currentLanguage = 'en';
    let translations = {
        en: { /* твои переводы */ },
        ru: { /* твои переводы */ }
    };
    let quests = [
        { id: 1, description: "Click 50 times", clicksRequired: 50, reward: 100, timeLimit: 3600 },
        { id: 2, description: "Click 100 times", clicksRequired: 100, reward: 200, timeLimit: 7200 }
    ];

    // Функции
    function init() {
        if (location.hash === '#demo') {
            isDemo = true;
            showGame('Demo');
        } else {
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUid = user.uid;
                    getUser(currentUid);
                    showGame();
                } else {
                    document.getElementById('loginMenu').style.display = 'block';
                    document.getElementById('gameScreen').style.display = 'none';
                }
            });
        }
    }

    async function getUser(uid) {
        const snapshot = await get(child(ref(db), 'users/' + uid));
        if (snapshot.exists()) {
            userData = snapshot.val();
            currentUsername = userData.username;
            return userData;
        }
        return null;
    }

    async function getUidByUsername(username) {
        const snapshot = await get(child(ref(db), 'usernames/' + username));
        return snapshot.exists() ? snapshot.val() : null;
    }

    function getCurrentUser() {
        if (isDemo) {
            return demoUser || { count: 0, money: 0, level: 0, has_small_cookie: 0, equipped_small_cookie: 0, has_medium_cookie: 0, equipped_medium_cookie: 0, has_large_cookie: 0, equipped_large_cookie: 0, is_blocked: 0, achieved_100: 0, achieved_500: 0, achieved_1000: 0, achieved_3000: 0, achieved_5000: 0, achieved_10000: 0, active_quest: null, completed_quests: [] };
        }
        return userData || { count: 0, money: 0, level: 0, has_small_cookie: 0, equipped_small_cookie: 0, has_medium_cookie: 0, equipped_medium_cookie: 0, has_large_cookie: 0, equipped_large_cookie: 0, is_blocked: 0, achieved_100: 0, achieved_500: 0, achieved_1000: 0, achieved_3000: 0, achieved_5000: 0, achieved_10000: 0, active_quest: null, completed_quests: [] };
    }

    function getUserByUsername(username) {
        return getUidByUsername(username).then(uid => uid ? getUser(uid) : null);
    }

    function increment() {
        var user = getCurrentUser();
        user.count = (parseFloat(user.count) || 0) + 1;
        document.getElementById('clicks').innerText = user.count;
        if (!isDemo) {
            update(ref(db, 'users/' + currentUid), { count: user.count });
        }
        checkQuestCompletion();
        checkAchievements(currentUsername);
    }

    async function doRegister() {
        var email = document.getElementById('registerEmail').value;
        var password = document.getElementById('registerPassword').value;
        var username = document.getElementById('registerUsername').value;
        try {
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            currentUid = userCredential.user.uid;
            await set(ref(db, 'users/' + currentUid), { username: username, count: 0, money: 0, level: 0, has_small_cookie: 0, equipped_small_cookie: 0, has_medium_cookie: 0, equipped_medium_cookie: 0, has_large_cookie: 0, equipped_large_cookie: 0, is_blocked: 0, achieved_100: 0, achieved_500: 0, achieved_1000: 0, achieved_3000: 0, achieved_5000: 0, achieved_10000: 0, active_quest: null, completed_quests: [] });
            await set(ref(db, 'usernames/' + username), currentUid);
            userData = await getUser(currentUid);
            currentUsername = username;
            showGame();
        } catch (error) {
            alert(error.message);
        }
    }

    async function doLogin() {
        var email = document.getElementById('loginEmail').value;
        var password = document.getElementById('loginPassword').value;
        try {
            const userCredential = await signInWithEmailAndPassword(auth, email, password);
            currentUid = userCredential.user.uid;
            userData = await getUser(currentUid);
            currentUsername = userData.username;
            showGame();
        } catch (error) {
            alert(error.message);
        }
    }

    async function doLogout() {
        const auth = getAuth();
        await signOut(auth);
        if (currentUid) {
            await update(ref(db, 'users/' + currentUid), { isOnline: false });
        }
        currentUid = null;
        userData = null;
        currentUsername = null;
        document.getElementById('loginMenu').style.display = 'block';
        document.getElementById('gameScreen').style.display = 'none';
        alert('Вы успешно вышли из аккаунта!');
    }

    function showGame(target) {
        document.getElementById('loginMenu').style.display = 'none';
        document.getElementById('gameScreen').style.display = 'block';
        var user = getCurrentUser();
        document.getElementById('clicks').innerText = user.count || 0;
        document.getElementById('money').innerText = user.money || 0;
        document.getElementById('level').innerText = user.level || 0;
        updateCurrentQuest();
    }

    function updateCurrentQuest() {
        var t = translations[currentLanguage];
        var user = getCurrentUser();
        if (user.active_quest === null) {
            document.getElementById('currentQuest').innerText = t.currentQuestNone;
        } else {
            var quest = quests.find(q => q.id === user.active_quest);
            if (quest) {
                var remaining = Math.max(0, quest.timeLimit - Math.floor((Date.now() - questStartTime) / 1000));
                document.getElementById('currentQuest').innerText = t.currentQuest.replace('{clicks}', questClicks).replace('{required}', quest.clicksRequired).replace('{remaining}', remaining);
            } else {
                document.getElementById('currentQuest').innerText = t.currentQuestNone;
            }
        }
    }

    function checkQuestCompletion() {
        var user = getCurrentUser();
        if (user.active_quest) {
            var quest = quests.find(q => q.id === user.active_quest);
            if (quest) {
                questClicks++;
                if (questClicks >= quest.clicksRequired) {
                    user.money = (parseFloat(user.money) || 0) + quest.reward;
                    user.completed_quests = user.completed_quests || [];
                    user.completed_quests.push(user.active_quest);
                    user.active_quest = null;
                    questClicks = 0;
                    questStartTime = Date.now();
                    if (!isDemo) {
                        update(ref(db, 'users/' + currentUid), { money: user.money, completed_quests: user.completed_quests, active_quest: null });
                    } else {
                        demoUser = { ...demoUser, money: user.money, completed_quests: user.completed_quests, active_quest: null };
                    }
                    alert('Quest completed! You earned ' + quest.reward + ' money!');
                }
            }
        }
    }

    function renderInventory() {
        var t = translations[currentLanguage];
        var user = getCurrentUser();
        var content = '<h3>' + t.inventoryTitle + '</h3>';
        content += '<p>' + t.smallCookie + ': ' + user.has_small_cookie + '</p>';
        content += '<p>' + t.mediumCookie + ': ' + user.has_medium_cookie + '</p>';
        content += '<p>' + t.largeCookie + ': ' + user.has_large_cookie + '</p>';
        content += '<button onclick="closeInventory()">' + t.close + '</button>';
        document.getElementById('inventoryMenu').innerHTML = content;
    }

    function showInventory() {
        document.getElementById('inventoryMenu').style.display = 'block';
        renderInventory();
    }

    function renderShop() {
        var t = translations[currentLanguage];
        var user = getCurrentUser();
        var content = '<h3>' + t.shopTitle + '</h3>';
        content += '<p>' + t.smallCookie + ' - 50 money <button onclick="buyItem(\'small_cookie\')">Buy</button></p>';
        content += '<p>' + t.mediumCookie + ' - 150 money <button onclick="buyItem(\'medium_cookie\')">Buy</button></p>';
        content += '<p>' + t.largeCookie + ' - 300 money <button onclick="buyItem(\'large_cookie\')">Buy</button></p>';
        content += '<button onclick="closeShop()">' + t.close + '</button>';
        document.getElementById('shopMenu').innerHTML = content;
    }

    function showShop() {
        document.getElementById('shopMenu').style.display = 'block';
        renderShop();
    }

    function renderQuests() {
        var t = translations[currentLanguage];
        var user = getCurrentUser();
        var content = '<h3>' + t.questsTitle + '</h3>';
        quests.forEach(function(quest) {
            var isCompleted = (user.completed_quests || []).includes(quest.id);
            var isActive = user.active_quest === quest.id;
            var status = isCompleted ? t.questCompleted : t.questNotCompleted;
            content += '<p>' + status + ' ' + quest.description + ' reward: ' + quest.reward + ' money</p>';
            if (!isCompleted) {
                if (isActive) {
                    content += '<button onclick="cancelQuest(' + quest.id + ')">' + t.cancelQuest + '</button>';
                } else {
                    content += '<button onclick="takeQuest(' + quest.id + ')">' + t.takeQuest + '</button>';
                }
            }
            content += '<br>';
        });
        content += '<button onclick="closeQuests()">' + t.close + '</button>';
        document.getElementById('questsMenu').innerHTML = content;
    }

    function showQuests() {
        document.getElementById('questsMenu').style.display = 'block';
        renderQuests();
    }

    function takeQuest(questId) {
        var user = getCurrentUser();
        if (!user.active_quest) {
            user.active_quest = questId;
            questClicks = 0;
            questStartTime = Date.now();
            if (!isDemo) {
                update(ref(db, 'users/' + currentUid), { active_quest: questId });
            } else {
                demoUser.active_quest = questId;
            }
            updateCurrentQuest();
            showQuests();
        } else {
            alert('You already have an active quest!');
        }
    }

    function cancelQuest(questId) {
        var user = getCurrentUser();
        if (user.active_quest === questId) {
            user.active_quest = null;
            questClicks = 0;
            if (!isDemo) {
                update(ref(db, 'users/' + currentUid), { active_quest: null });
            } else {
                demoUser.active_quest = null;
            }
            updateCurrentQuest();
            showQuests();
        }
    }

    async function checkAchievements(target) {
        var t = translations[currentLanguage];
        var user;
        if (isDemo && target === 'Demo') {
            user = demoUser || { count: 0 };
        } else {
            user = (target === currentUsername) ? userData : await getUserByUsername(target);
            if (!user) return;
        }
        var userCount = parseFloat(user.count) || 0;
        var achievements = [
            { threshold: 100, field: 'achieved_100', name: t.achievement100, amount: 100 },
            { threshold: 500, field: 'achieved_500', name: t.achievement500, amount: 500 },
            { threshold: 1000, field: 'achieved_1000', name: t.achievement1000, amount: 1000 },
            { threshold: 3000, field: 'achieved_3000', name: t.achievement3000, amount: 3000 },
            { threshold: 5000, field: 'achieved_5000', name: t.achievement5000, amount: 5000 },
            { threshold: 10000, field: 'achieved_10000', name: t.achievement10000, amount: 10000 }
        ];
        var updates = {};
        achievements.forEach(ach => {
            if (userCount >= ach.threshold && !user[ach.field]) {
                updates[ach.field] = 1;
                if (target === currentUsername) alert(t.achievementUnlocked.replace('{name}', ach.name).replace('{amount}', ach.amount));
            }
        });
        if (Object.keys(updates).length > 0) {
            if (isDemo && target === 'Demo') {
                Object.assign(demoUser || {}, updates);
            } else {
                var uid = (target === currentUsername) ? currentUid : await getUidByUsername(target);
                if (uid) await update(ref(db, 'users/' + uid), updates);
                if (target === currentUsername) {
                    Object.assign(userData || {}, updates);
                }
            }
        }
    }

    function renderAchievements() {
        var t = translations[currentLanguage];
        var user = getCurrentUser();
        var content = '<h3>' + t.achievementsTitle + '</h3>';
        content += '<p>' + (user.achieved_100 ? t.achievement100 + ' (100 clicks)' : t.achievement100Locked) + '</p>';
        content += '<p>' + (user.achieved_500 ? t.achievement500 + ' (500 clicks)' : t.achievement500Locked) + '</p>';
        content += '<p>' + (user.achieved_1000 ? t.achievement1000 + ' (1000 clicks)' : t.achievement1000Locked) + '</p>';
        content += '<p>' + (user.achieved_3000 ? t.achievement3000 + ' (3000 clicks)' : t.achievement3000Locked) + '</p>';
        content += '<p>' + (user.achieved_5000 ? t.achievement5000 + ' (5000 clicks)' : t.achievement5000Locked) + '</p>';
        content += '<p>' + (user.achieved_10000 ? t.achievement10000 + ' (10000 clicks)' : t.achievement10000Locked) + '</p>';
        content += '<button onclick="closeAchievements()">' + t.close + '</button>';
        document.getElementById('achievementsMenu').innerHTML = content;
    }

    function showAchievements() {
        document.getElementById('achievementsMenu').style.display = 'block';
        renderAchievements();
    }

    // Закрывающие функции (пример)
    function closeInventory() { document.getElementById('inventoryMenu').style.display = 'none'; }
    function closeShop() { document.getElementById('shopMenu').style.display = 'none'; }
    function closeQuests() { document.getElementById('questsMenu').style.display = 'none'; }
    function closeAchievements() { document.getElementById('achievementsMenu').style.display = 'none'; }

    // Экспорт в глобальную область
    window.doRegister = doRegister;
    window.doLogin = doLogin;
    window.increment = increment;
    window.getCurrentUser = getCurrentUser;
    window.getUserByUsername = getUserByUsername;
    window.userData = userData;
    window.currentUid = currentUid;
    window.showGame = showGame;
    window.checkQuestCompletion = checkQuestCompletion;
    window.checkAchievements = checkAchievements;
    window.renderInventory = renderInventory;
    window.showInventory = showInventory;
    window.renderQuests = renderQuests;
    window.showQuests = showQuests;
    window.renderShop = renderShop;
    window.showShop = showShop;
    window.renderAchievements = renderAchievements;
    window.showAchievements = showAchievements;
    window.doLogout = doLogout;
    window.quests = quests;
    window.updateCurrentQuest = updateCurrentQuest;
    window.takeQuest = takeQuest;
    window.cancelQuest = cancelQuest;
</script>



  <style>
    html, body {
      overflow: hidden;  /* Скрывает все полосы прокрутки */
      margin: 0;         /* Убирает лишние отступы */
      padding: 0;        /* Убирает padding */
      height: 100%;      /* Заставляет body занимать весь экран */
      width: 100%;       /* Заставляет body занимать весь экран */
      font-family: Arial; 
      background: #000 url('https://www.transparenttextures.com/patterns/stardust.png'); /* Space background */
      color: #fff; /* White text for space theme */
    }
    .container {
      width: 320px;
      margin: 50px auto 0 auto;
      background: rgba(0, 0, 50, 0.8); /* Dark blue semi-transparent for space feel */
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.5); /* Neon glow */
      position: relative;
      left: 50px;
      transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out, box-shadow 0.5s ease;
    }
    .container:hover {
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.8); /* Enhanced glow on hover */
    }
    .container.fade-in {
      opacity: 1;
      transform: translateY(0);
    }
    input { 
      width: 100%; 
      padding: 8px; 
      margin: 8px 0; 
      box-sizing: border-box; 
      transition: border-color 0.3s, box-shadow 0.3s; 
      border: 1px solid #00ffff; /* Cyan border */
      background: rgba(0, 0, 0, 0.5);
      color: #fff;
    }
    input:focus { 
      border-color: #ff00ff; /* Magenta on focus */
      box-shadow: 0 0 10px #ff00ff;
    }
    button { 
      padding: 8px 16px; 
      margin-right: 10px; 
      transition: background-color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease, color 0.3s ease; 
      cursor: pointer;
      border: none;
      border-radius: 5px;
      background-color: #4CAF50; /* Default green, but will override for theme */
      color: white;
    }
    button:hover { 
      transform: scale(1.1) rotate(2deg); /* More animation: scale and rotate */
      box-shadow: 0 4px 8px rgba(255, 0, 255, 0.5), 0 0 20px rgba(0, 255, 255, 0.7); /* Glowing shadow */
      background-color: #45a049;
    }
    button:active {
      transform: scale(0.95) rotate(-2deg); /* Click animation */
      box-shadow: 0 0 10px rgba(255, 255, 0, 0.8); /* Yellow flash on click */
    }
    #msg { margin-top: 10px; height: 18px; color: red; }
    .link-button {
      background: none;
      border: none;
      color: #00ffff; /* Cyan for links */
      text-decoration: underline;
      cursor: pointer;
      padding: 0;
      font-size: 14px;
      transition: color 0.3s ease, transform 0.3s ease, text-shadow 0.3s ease;
    }
    .link-button:hover {
      color: #ff00ff; /* Magenta on hover */
      transform: scale(1.1);
      text-shadow: 0 0 5px #ff00ff;
    }
    #loadingScreen {
      text-align: center;
      margin-top: 50px;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
      color: #00ffff; /* Cyan text */
    }
    #loadingScreen.visible {
      opacity: 1;
    }
    #gameScreen {
      text-align: center;
      margin-top: 100px;
      position: relative;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
    }
    #gameScreen.visible {
      opacity: 1;
      transform: translateY(0);
    }
    #gameScreen button {
      font-size: 20px;
      padding: 10px 20px;
      background-color: #2196F3; /* Blue for space */
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
    }
    #gameScreen button:hover {
      background-color: #0b7dda;
      transform: scale(1.2) rotate(5deg); /* More dynamic animation */
      box-shadow: 0 0 15px #00ffff;
    }
    #gameScreen button:active {
      transform: scale(1.0) rotate(-5deg);
      box-shadow: 0 0 20px #ff00ff;
    }
    #shopButton, #inventoryButton, #questsButton {
      position: absolute;
      left: 10px;
      font-size: 16px;
      padding: 8px 16px;
      background-color: #FF9800; /* Orange override */
    }
    #shopButton {
      top: 0px;
    }
    #inventoryButton {
      top: 40px;
    }
    #questsButton {
      top: 80px;
    }
    #achievementsButton, #promoButton {
      position: absolute;
      right: 10px;
      font-size: 16px;
      padding: 8px 16px;
    }
    #achievementsButton {
      top: 40px;
      background-color: #2196F3;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #achievementsButton:hover {
      background-color: #0b7dda;
    }
    #promoButton {
      top: 80px;
      background-color: #2196F3;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #promoButton:hover {
      background-color: #0b7dda;
    }
    #exitButton {
      position: absolute;
      top: 120px;
      right: 10px;
      background-color: red;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 8px 16px;
      cursor: pointer;
      font-size: 16px;
    }
    #exitButton:hover {
      background-color: darkred;
    }
    #shopMenu, #inventoryMenu, #adminMenu, #issueClicksMenu, #issueCookieMenu, #issueAchievementMenu, #blockedMenu, #achievementsMenu, #promoMenu, #demoExpiredMenu, #consoleMenu, #questsMenu, #settingsMenu {
      display: none;
      position: absolute;
      background: rgba(0, 0, 50, 0.9); /* Space dark blue */
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
      width: 300px;
      z-index: 3000;
      cursor: move;
      opacity: 0;
      transform: scale(0.95) translateY(-20px);
      transition: opacity 0.5s ease, transform 0.5s ease, box-shadow 0.5s ease;
      color: #fff;
    }
    #shopMenu.open, #inventoryMenu.open, #adminMenu.open, #issueClicksMenu.open, #issueCookieMenu.open, #issueAchievementMenu.open, #blockedMenu.open, #achievementsMenu.open, #promoMenu.open, #demoExpiredMenu.open, #consoleMenu.open, #questsMenu.open, #settingsMenu.open {
      opacity: 1;
      transform: scale(1) translateY(0);
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.8);
    }
    #shopMenu {
      top: 20%;
      left: 30%;
    }
    #inventoryMenu {
      top: 20%;
      left: 50%;
    }
    #adminMenu {
      top: 20%;
      left: 40%;
    }
    #issueClicksMenu, #issueCookieMenu, #issueAchievementMenu, #blockedMenu, #promoMenu, #demoExpiredMenu, #consoleMenu {
      top: 30%;
      left: 40%;
    }
    #achievementsMenu, #questsMenu, #settingsMenu {
      top: 20%;
      left: 40%;
    }
    #questsMenu {
      max-height: 400px;
      overflow-y: auto;
    }
    #shopMenu h3, #inventoryMenu h3, #adminMenu h3, #issueClicksMenu h3, #issueCookieMenu h3, #issueAchievementMenu h3, #blockedMenu h3, #achievementsMenu h3, #promoMenu h3, #demoExpiredMenu h3, #consoleMenu h3, #questsMenu h3, #settingsMenu h3 {
      margin-top: 0;
      color: #00ffff; /* Cyan headers */
      cursor: grab;
      text-shadow: 0 0 5px #00ffff;
    }
    #shopMenu button, #inventoryMenu button, #adminMenu button, #issueClicksMenu button, #issueCookieMenu button, #issueAchievementMenu button, #blockedMenu button, #achievementsMenu button, #promoMenu button, #demoExpiredMenu button, #consoleMenu button, #questsMenu button, #settingsMenu button {
      font-size: 16px;
      padding: 8px 16px;
      margin-top: 10px;
      background-color: #2196F3;
      transition: background-color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
    }
    #shopMenu button:hover, #inventoryMenu button:hover, #adminMenu button:hover, #issueClicksMenu button:hover, #issueCookieMenu button:hover, #issueAchievementMenu button:hover, #blockedMenu button:hover, #achievementsMenu button:hover, #promoMenu button:hover, #demoExpiredMenu button:hover, #consoleMenu button:hover, #questsMenu button:hover, #settingsMenu button:hover {
      transform: scale(1.1) rotate(3deg);
      box-shadow: 0 0 15px #ff00ff;
    }
    #shopMenu button:active, #inventoryMenu button:active, #adminMenu button:active, #issueClicksMenu button:active, #issueCookieMenu button:active, #issueAchievementMenu button:active, #blockedMenu button:active, #achievementsMenu button:active, #promoMenu button:active, #demoExpiredMenu button:active, #consoleMenu button:active, #questsMenu button:active, #settingsMenu button:active {
      transform: scale(0.9) rotate(-3deg);
      box-shadow: 0 0 20px #ffff00;
    }
    h2 {
      color: #00ffff;
      font-size: 24px;
      transition: color 0.3s ease, text-shadow 0.3s ease;
      text-shadow: 0 0 5px #00ffff;
    }
    h2:hover {
      color: #ff00ff;
      text-shadow: 0 0 10px #ff00ff;
    }
    #keyContainer {
      text-align: center;
      margin-top: 50px;
      opacity: 1;
      transform: translateY(0);
      transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
    }
    #keyContainer.fade-out {
      opacity: 0;
      transform: translateY(-20px);
    }
    #authContainer {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
    }
    #authContainer.fade-in {
      opacity: 1;
      transform: translateY(0);
    }
    #currentQuest {
      color: #ffff00;
      font-size: 18px;
      margin-bottom: 10px;
    }
    #pauseOverlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }
    #pauseMenu {
      background: rgba(0, 0, 50, 0.9);
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
      text-align: center;
      color: #fff;
    }
    #pauseMenu button {
      display: block;
      margin: 10px auto;
      width: 200px;
    }
  </style>
</head>
<body onload="init();">
  <div id="keyContainer" class="container">
    <h2 id="enterKeyTitle"></h2>
    <input type="text" id="inputText" placeholder=""><br><br>
    <button id="submitKeyButton" onclick="checkKey()"></button><br><br>
    <button id="exitKeyButton" onclick="window.close()"></button>
    <div id="demoContainer" style="position: absolute; bottom: 20px; left: 20px;">
      <button id="demoModeButton" onclick="enterDemoMode()"></button>
    </div>
  </div>

  <div class="container" id="authContainer" style="display:none;">
    <!-- Вход -->
    <div id="loginScreen">
      <h3 id="loginTitle"></h3>
      <input id="loginUsername" type="text" placeholder="" />
      <input id="loginPassword" type="password" placeholder="" />
      <div>
        <button id="loginButton" onclick="doLogin()"></button>
      </div>
      <div style="margin-top:10px;">
        <span id="noAccountText"></span> <button class="link-button" id="registerLink" onclick="showRegister()"></button>
      </div>
      <div id="loginMsg"></div>
    </div>

    <!-- Регистрация -->
    <div id="registerScreen" style="display:none;">
      <h3 id="registerTitle"></h3>
      <input id="regUsername" type="text" placeholder="" />
      <input id="regPassword" type="password" placeholder="" />
      <div>
        <button id="registerButton" onclick="doRegister()"></button>
        <button id="backButton" onclick="showLogin()"></button>
      </div>
      <div id="registerMsg"></div>
    </div>
  </div>

  <div id="loadingScreen" style="display:none;">
    <h2 id="loadingText"></h2>
  </div>

  <div id="gameScreen" style="display:none;">
    <button id="shopButton" onclick="showShop()"></button>
    <button id="inventoryButton" onclick="showInventory()"></button>
    <button id="questsButton" onclick="showQuests()"></button>
    <h2 id="level"></h2>
    <h2 id="counter"></h2>
    <h2 id="money"></h2>
    <button id="clickButton" onclick="increment()"></button>
    <button id="achievementsButton" onclick="showAchievements()"></button>
    <button id="promoButton" onclick="showPromo()"></button>
    <button id="exitButton" onclick="doLogout()"></button>
    <p id="currentQuest"></p>
  </div>

  <div id="shopMenu">
    <!-- Dynamic content will be inserted here -->
  </div>

  <div id="inventoryMenu">
    <!-- Dynamic content will be inserted here -->
  </div>

  <div id="adminMenu">
    <!-- Dynamic content will be inserted here -->
  </div>

  <div id="issueClicksMenu">
    <!-- Dynamic content will be inserted here -->
  </div>

  <div id="issueCookieMenu">
    <!-- Dynamic content will be inserted here -->
  </div>

  <div id="issueAchievementMenu">
    <!-- Dynamic content will be inserted here -->
  </div>

  <div id="blockedMenu">
    <!-- Dynamic content will be inserted here -->
  </div>

  <div id="achievementsMenu">
    <!-- Dynamic content will be inserted here -->
  </div>

  <div id="promoMenu">
    <!-- Dynamic content will be inserted here -->
  </div>

  <div id="demoExpiredMenu">
    <!-- Dynamic content will be inserted here -->
  </div>

  <div id="consoleMenu">
    <!-- Dynamic content will be inserted here -->
  </div>

  <div id="questsMenu">
    <!-- Dynamic content will be inserted here -->
  </div>

  <div id="settingsMenu">
    <!-- Dynamic content will be inserted here -->
  </div>

  <div id="pauseOverlay">
    <div id="pauseMenu">
      <h3 id="pauseTitle"></h3>
      <button id="resumeButton" onclick="resumeGame()"></button>
      <button id="settingsButton" onclick="showSettings()"></button>
      <button id="logoutButton" onclick="doLogout()"></button>
    </div>
  </div>

<script>
  var currentUsername = '';
  var count = 0;
  var money = 0;
  var internal_level = 0;
  var isDemo = false;
  var demoUser = null;
  var demoTimerInterval = null;
  var demoTimeLeft = 180; // 3 minutes in seconds
  var isInfiniteDemo = false;
  var demoJustExpired = false;
  var questUpdateInterval = null;
  var isPaused = false;
  var pauseStartTime = null;
  var wasQuestActive = false;
  var wasDemoTimerActive = false;
  var keys = {};
  var currentLanguage = localStorage.getItem('language') || 'ru';

  var translations = {
    ru: {
      title: 'Clicker',
      enterKeyTitle: 'Введите ключ для продолжения',
      enterKeyPlaceholder: 'Введите ключ',
      submitKeyButton: 'Ввести',
      exitKeyButton: 'Выйти',
      demoModeButton: 'Demo Mode',
      loginTitle: 'Вход',
      usernamePlaceholder: 'Имя пользователя',
      passwordPlaceholder: 'Пароль',
      loginButton: 'Войти',
      noAccountText: 'Нет аккаунта?',
      registerLink: 'Зарегистрироваться',
      registerTitle: 'Регистрация',
      registerButton: 'Зарегистрироваться',
      backButton: 'Назад',
      loadingText: 'Загрузка кликера',
      shopButton: 'Магазин',
      inventoryButton: 'Инвентарь',
      questsButton: 'Задания',
      level: 'Уровень: ',
      counter: 'Накликано: ',
      money: 'Деньги: ',
      clickButton: 'Клик',
      achievementsButton: 'Достижения',
      promoButton: 'Промокоды',
      exitButton: 'Выйти',
      currentQuestNone: 'Текущее задание: нет',
      pauseTitle: 'Пауза',
      resumeButton: 'Продолжить',
      settingsButton: 'Настройки',
      logoutButton: 'Выйти',
      keyNoDate: 'Ключ для сегодняшнего дня не задан.',
      keyIncorrect: 'Неверный ключ.',
      keyCorrect: 'Ключ верный — доступ разрешён.',
      enterUsernamePassword: 'Введите имя и пароль',
      invalidUsernamePassword: 'Неверное имя или пароль',
      userExists: 'Пользователь уже существует',
      registrationSuccess: 'Регистрация успешна!',
      loginSuccess: 'Успешный вход!',
      shopTitle: 'Магазин',
      smallCookie: 'маленькая печенька',
      mediumCookie: 'Средняя Печенька',
      largeCookie: 'Большая Печенька',
      buy: 'Купить',
      bought: '(Куплено)',
      close: 'Закрыть',
      notEnoughClicks: 'Недостаточно кликов!',
      boughtSuccess: 'Куплено!',
      inventoryTitle: 'Инвентарь',
      equipped: ' - Экипировано',
      unequip: 'Снять',
      equip: 'Экипировать',
      inventoryEmpty: 'Ваш инвентарь пуст!',
      adminPanelTitle: 'Админ Панель',
      targetUsernamePlaceholder: 'Имя аккаунта',
      issueClicks: 'Выдать клики',
      issueCookie: 'Выдать печеньку',
      issueAchievement: 'Выдать достижение',
      block: 'Заблокировать',
      unblock: 'Разблокировать',
      resetClicks: 'Сбросить клики',
      issueClicksTitle: 'Выдать клики',
      clickAmountPlaceholder: 'Количество кликов',
      issue: 'Выдать',
      invalidAmount: 'Неверное количество!',
      issuedClicks: 'Выдано {amount} кликов для {target}',
      issueCookieTitle: 'Выдать печеньку',
      small: 'Маленькую',
      medium: 'Среднюю',
      large: 'Большую',
      issuedCookieSmall: 'Дана маленькая печенька для {target}',
      issuedCookieMedium: 'Дана средняя печенька для {target}',
      issuedCookieLarge: 'Дана большая печенька для {target}',
      issueAchievementTitle: 'Выдать достижение',
      achievement100: '100',
      achievement500: 'Пятихатка',
      achievement1000: 'Косарь',
      achievement3000: '3 конуса',
      achievement5000: 'Пятёрик',
      achievement10000: 'У тебя нервы железные?',
      issuedAchievement: 'Дано достижение {name} для {target}',
      blocked: 'Аккаунт {target} заблокирован',
      unblocked: 'Аккаунт {target} разблокирован',
      clicksReset: 'Клики сброшены для {target}',
      enterUsername: 'Введите имя аккаунта!',
      userNotFound: 'Пользователь не найден!',
      blockedTitle: 'Блокировка аккаунта',
      blockedText: 'Ваш аккаунт был заблокирован Администратором',
      userNotFoundAlert: 'Пользователь не найден!',
      demoLabel: 'Demo Mode',
      demoTimer: 'Оставшееся время: ',
      demoExpiredTitle: 'Время истекло',
      demoExpiredText: 'Время пробного тестирования окончено',
      ok: 'Ок',
      achievementsTitle: 'Достижения',
      achieved: 'Получено',
      notAchieved: 'Не получено',
      achievement100Desc: '100 (достигнуть 100 кликов): ',
      achievement500Desc: 'Пятихатка (достигнуть 500 кликов): ',
      achievement1000Desc: 'Косарь (достигнуть 1000 кликов): ',
      achievement3000Desc: '3 конуса (достигнуть 3000 кликов): ',
      achievement5000Desc: 'Пятёрик (достигнуть 5000 кликов): ',
      achievement10000Desc: 'У тебя нервы железные? (достигнуть 10000 кликов): ',
      promoTitle: 'Промокоды',
      promoPlaceholder: 'Введите промокод',
      redeem: 'Ввести',
      invalidPromo: 'Неверный промокод!',
      promoSmallCookie: 'Получена маленькая печенька!',
      promo100Clicks: 'Получено 100 кликов!',
      promoLargeCookie: 'Получена большая печенька!',
      consoleTitle: 'Консоль',
      consolePlaceholder: 'Введите команду',
      execute: 'Ввести',
      enterCommand: 'Введите команду!',
      invalidCommand: 'Неизвестная команда: {command}',
      setClicksSuccess: 'Клики установлены на {amount}',
      invalidNumber: 'Неверное число в команде!',
      invalidFormat: 'Неверный формат команды! Используйте {format}',
      gaveSmallCookie: 'Получена маленькая печенька!',
      gaveMediumCookie: 'Получена средняя печенька!',
      gaveLargeCookie: 'Получена большая печенька!',
      notInDemo: 'Вы не в Demo Mode!',
      exitDemo: 'Выход из Demo Mode',
      notInKeyMenu: 'Не в меню с ключами!',
      autoPassKey: 'Auto passing key to registration',
      invalidTimeFormat: 'Неверный формат времени!',
      demoTimeSet: 'Demo time set to {time}',
      demoTimeInfinity: 'Demo time set to infinity',
      questsTitle: 'Задания',
      questCompleted: '✅',
      questNotCompleted: '❌',
      takeQuest: 'Взять',
      cancelQuest: 'Снять',
      activeQuest: 'У вас уже есть активное задание!',
      questCancelled: 'Задание отменено!',
      questTimeExpired: 'Время на задание истекло! Задание провалено.',
      questCompletedSuccess: 'Задание выполнено! Награда: {reward} денег.',
      currentQuest: 'Текущее задание: накликать {clicks}/{required} кликов за {remaining} секунд',
      settingsTitle: 'Настройки',
      uiScaleLabel: 'Размер интерфейса:',
      smallScale: 'Маленький',
      mediumScale: 'Средний',
      largeScale: 'Большой',
      languageLabel: 'Язык:',
      russian: 'Русский',
      english: 'English',
      ukrainian: 'Українська',
      apply: 'Применить',
      achievementUnlocked: 'Достижение разблокировано: {name}\nПоздравляем! Вы достигли {amount} кликов.',
      promoDisabledInDemo: 'Промокоды недоступны в Demo Mode',
      demoTimerInfinity: 'Оставшееся время: Infinity',
      questDescTemplate: 'накликать {required} кликов за {time} секунд'
    },
    en: {
      title: 'Clicker',
      enterKeyTitle: 'Enter key to continue',
      enterKeyPlaceholder: 'Enter key',
      submitKeyButton: 'Submit',
      exitKeyButton: 'Exit',
      demoModeButton: 'Demo Mode',
      loginTitle: 'Login',
      usernamePlaceholder: 'Username',
      passwordPlaceholder: 'Password',
      loginButton: 'Login',
      noAccountText: 'No account?',
      registerLink: 'Register',
      registerTitle: 'Registration',
      registerButton: 'Register',
      backButton: 'Back',
      loadingText: 'Loading clicker',
      shopButton: 'Shop',
      inventoryButton: 'Inventory',
      questsButton: 'Quests',
      level: 'Level: ',
      counter: 'Clicks: ',
      money: 'Money: ',
      clickButton: 'Click',
      achievementsButton: 'Achievements',
      promoButton: 'Promo codes',
      exitButton: 'Logout',
      currentQuestNone: 'Current quest: none',
      pauseTitle: 'Pause',
      resumeButton: 'Resume',
      settingsButton: 'Settings',
      logoutButton: 'Logout',
      keyNoDate: 'Key for today is not set.',
      keyIncorrect: 'Invalid key.',
      keyCorrect: 'Key is correct — access granted.',
      enterUsernamePassword: 'Enter username and password',
      invalidUsernamePassword: 'Invalid username or password',
      userExists: 'User already exists',
      registrationSuccess: 'Registration successful!',
      loginSuccess: 'Successful login!',
      shopTitle: 'Shop',
      smallCookie: 'small cookie',
      mediumCookie: 'Medium Cookie',
      largeCookie: 'Large Cookie',
      buy: 'Buy',
      bought: '(Bought)',
      close: 'Close',
      notEnoughClicks: 'Not enough clicks!',
      boughtSuccess: 'Bought!',
      inventoryTitle: 'Inventory',
      equipped: ' - Equipped',
      unequip: 'Unequip',
      equip: 'Equip',
      inventoryEmpty: 'Your inventory is empty!',
      adminPanelTitle: 'Admin Panel',
      targetUsernamePlaceholder: 'Account name',
      issueClicks: 'Issue clicks',
      issueCookie: 'Issue cookie',
      issueAchievement: 'Issue achievement',
      block: 'Block',
      unblock: 'Unblock',
      resetClicks: 'Reset clicks',
      issueClicksTitle: 'Issue clicks',
      clickAmountPlaceholder: 'Number of clicks',
      issue: 'Issue',
      invalidAmount: 'Invalid amount!',
      issuedClicks: 'Issued {amount} clicks to {target}',
      issueCookieTitle: 'Issue cookie',
      small: 'Small',
      medium: 'Medium',
      large: 'Large',
      issuedCookieSmall: 'Issued small cookie to {target}',
      issuedCookieMedium: 'Issued medium cookie to {target}',
      issuedCookieLarge: 'Issued large cookie to {target}',
      issueAchievementTitle: 'Issue achievement',
      achievement100: '100',
      achievement500: 'Five hundred',
      achievement1000: 'Thousand',
      achievement3000: '3 cones',
      achievement5000: 'Five grand',
      achievement10000: 'Do you have iron nerves?',
      issuedAchievement: 'Issued achievement {name} to {target}',
      blocked: 'Account {target} blocked',
      unblocked: 'Account {target} unblocked',
      clicksReset: 'Clicks reset for {target}',
      enterUsername: 'Enter account name!',
      userNotFound: 'User not found!',
      blockedTitle: 'Account Blocked',
      blockedText: 'Your account has been blocked by the Administrator',
      userNotFoundAlert: 'User not found!',
      demoLabel: 'Demo Mode',
      demoTimer: 'Time left: ',
      demoExpiredTitle: 'Time Expired',
      demoExpiredText: 'Trial testing time is over',
      ok: 'Ok',
      achievementsTitle: 'Achievements',
      achieved: 'Achieved',
      notAchieved: 'Not achieved',
      achievement100Desc: '100 (reach 100 clicks): ',
      achievement500Desc: 'Five hundred (reach 500 clicks): ',
      achievement1000Desc: 'Thousand (reach 1000 clicks): ',
      achievement3000Desc: '3 cones (reach 3000 clicks): ',
      achievement5000Desc: 'Five grand (reach 5000 clicks): ',
      achievement10000Desc: 'Do you have iron nerves? (reach 10000 clicks): ',
      promoTitle: 'Promo codes',
      promoPlaceholder: 'Enter promo code',
      redeem: 'Redeem',
      invalidPromo: 'Invalid promo code!',
      promoSmallCookie: 'Received small cookie!',
      promo100Clicks: 'Received 100 clicks!',
      promoLargeCookie: 'Received large cookie!',
      consoleTitle: 'Console',
      consolePlaceholder: 'Enter command',
      execute: 'Execute',
      enterCommand: 'Enter command!',
      invalidCommand: 'Unknown command: {command}',
      setClicksSuccess: 'Clicks set to {amount}',
      invalidNumber: 'Invalid number in command!',
      invalidFormat: 'Invalid command format! Use {format}',
      gaveSmallCookie: 'Received small cookie!',
      gaveMediumCookie: 'Received medium cookie!',
      gaveLargeCookie: 'Received large cookie!',
      notInDemo: 'You are not in Demo Mode!',
      exitDemo: 'Exiting Demo Mode',
      notInKeyMenu: 'Not in key menu!',
      autoPassKey: 'Auto passing key to registration',
      invalidTimeFormat: 'Invalid time format!',
      demoTimeSet: 'Demo time set to {time}',
      demoTimeInfinity: 'Demo time set to infinity',
      questsTitle: 'Quests',
      questCompleted: '✅',
      questNotCompleted: '❌',
      takeQuest: 'Take',
      cancelQuest: 'Cancel',
      activeQuest: 'You already have an active quest!',
      questCancelled: 'Quest cancelled!',
      questTimeExpired: 'Quest time expired! Quest failed.',
      questCompletedSuccess: 'Quest completed! Reward: {reward} money.',
      currentQuest: 'Current quest: click {clicks}/{required} clicks in {remaining} seconds',
      settingsTitle: 'Settings',
      uiScaleLabel: 'UI Scale:',
      smallScale: 'Small',
      mediumScale: 'Medium',
      largeScale: 'Large',
      languageLabel: 'Language:',
      russian: 'Russian',
      english: 'English',
      ukrainian: 'Ukrainian',
      apply: 'Apply',
      achievementUnlocked: 'Achievement unlocked: {name}\nCongratulations! You reached {amount} clicks.',
      promoDisabledInDemo: 'Promo codes are unavailable in Demo Mode',
      demoTimerInfinity: 'Time left: Infinity',
      questDescTemplate: 'reach {required} clicks in {time} seconds'
    },
    uk: {
      title: 'Клікер',
      enterKeyTitle: 'Введіть ключ для продовження',
      enterKeyPlaceholder: 'Введіть ключ',
      submitKeyButton: 'Ввести',
      exitKeyButton: 'Вийти',
      demoModeButton: 'Demo Mode',
      loginTitle: 'Вхід',
      usernamePlaceholder: "Ім'я користувача",
      passwordPlaceholder: 'Пароль',
      loginButton: 'Увійти',
      noAccountText: 'Немає облікового запису?',
      registerLink: 'Зареєструватися',
      registerTitle: 'Реєстрація',
      registerButton: 'Зареєструватися',
      backButton: 'Назад',
      loadingText: 'Завантаження клікера',
      shopButton: 'Магазин',
      inventoryButton: 'Інвентар',
      questsButton: 'Завдання',
      level: 'Рівень: ',
      counter: 'Наклікано: ',
      money: 'Гроші: ',
      clickButton: 'Клік',
      achievementsButton: 'Досягнення',
      promoButton: 'Промокоди',
      exitButton: 'Вийти',
      currentQuestNone: 'Поточне завдання: немає',
      pauseTitle: 'Пауза',
      resumeButton: 'Продовжити',
      settingsButton: 'Налаштування',
      logoutButton: 'Вийти',
      keyNoDate: 'Ключ для сьогоднішнього дня не задано.',
      keyIncorrect: 'Невірний ключ.',
      keyCorrect: 'Ключ вірний — доступ дозволено.',
      enterUsernamePassword: "Введіть ім'я та пароль",
      invalidUsernamePassword: "Невірне ім'я або пароль",
      userExists: 'Користувач вже існує',
      registrationSuccess: 'Реєстрація успішна!',
      loginSuccess: 'Успішний вхід!',
      shopTitle: 'Магазин',
      smallCookie: 'маленьке печиво',
      mediumCookie: 'Середнє Печиво',
      largeCookie: 'Велике Печиво',
      buy: 'Купити',
      bought: '(Куплено)',
      close: 'Закрити',
      notEnoughClicks: 'Недостатньо кліків!',
      boughtSuccess: 'Куплено!',
      inventoryTitle: 'Інвентар',
      equipped: ' - Екіпіровано',
      unequip: 'Зняти',
      equip: 'Екіпірувати',
      inventoryEmpty: 'Ваш інвентар порожній!',
      adminPanelTitle: 'Адмін Панель',
      targetUsernamePlaceholder: "Ім'я облікового запису",
      issueClicks: 'Видати кліки',
      issueCookie: 'Видати печиво',
      issueAchievement: 'Видати досягнення',
      block: 'Заблокувати',
      unblock: 'Розблокувати',
      resetClicks: 'Скинути кліки',
      issueClicksTitle: 'Видати кліки',
      clickAmountPlaceholder: 'Кількість кліків',
      issue: 'Видати',
      invalidAmount: 'Невірна кількість!',
      issuedClicks: 'Видано {amount} кліків для {target}',
      issueCookieTitle: 'Видати печиво',
      small: 'Маленьке',
      medium: 'Середнє',
      large: 'Велике',
      issuedCookieSmall: 'Видано маленьке печиво для {target}',
      issuedCookieMedium: 'Видано середнє печиво для {target}',
      issuedCookieLarge: 'Видано велике печиво для {target}',
      issueAchievementTitle: 'Видати досягнення',
      achievement100: '100',
      achievement500: 'П\'ятихатка',
      achievement1000: 'Косар',
      achievement3000: '3 конуса',
      achievement5000: 'П\'ятірик',
      achievement10000: 'У тебе нерви залізні?',
      issuedAchievement: 'Видано досягнення {name} для {target}',
      blocked: 'Обліковий запис {target} заблоковано',
      unblocked: 'Обліковий запис {target} розблоковано',
      clicksReset: 'Кліки скинуто для {target}',
      enterUsername: "Введіть ім'я облікового запису!",
      userNotFound: 'Користувач не знайдений!',
      blockedTitle: 'Блокування облікового запису',
      blockedText: 'Ваш обліковий запис було заблоковано Адміністратором',
      userNotFoundAlert: 'Користувач не знайдений!',
      demoLabel: 'Demo Mode',
      demoTimer: 'Залишився час: ',
      demoExpiredTitle: 'Час минув',
      demoExpiredText: 'Час пробного тестування закінчено',
      ok: 'Ок',
      achievementsTitle: 'Досягнення',
      achieved: 'Отримано',
      notAchieved: 'Не отримано',
      achievement100Desc: '100 (досягти 100 кліків): ',
      achievement500Desc: 'П\'ятихатка (досягти 500 кліків): ',
      achievement1000Desc: 'Косар (досягти 1000 кліків): ',
      achievement3000Desc: '3 конуса (досягти 3000 кліків): ',
      achievement5000Desc: 'П\'ятірик (досягти 5000 кліків): ',
      achievement10000Desc: 'У тебе нерви залізні? (досягти 10000 кліків): ',
      promoTitle: 'Промокоди',
      promoPlaceholder: 'Введіть промокод',
      redeem: 'Ввести',
      invalidPromo: 'Невірний промокод!',
      promoSmallCookie: 'Отримано маленьке печиво!',
      promo100Clicks: 'Отримано 100 кліків!',
      promoLargeCookie: 'Отримано велике печиво!',
      consoleTitle: 'Консоль',
      consolePlaceholder: 'Введіть команду',
      execute: 'Ввести',
      enterCommand: 'Введіть команду!',
      invalidCommand: 'Невідома команда: {command}',
      setClicksSuccess: 'Кліки встановлено на {amount}',
      invalidNumber: 'Невірне число в команді!',
      invalidFormat: 'Невірний формат команди! Використовуйте {format}',
      gaveSmallCookie: 'Отримано маленьке печиво!',
      gaveMediumCookie: 'Отримано середнє печиво!',
      gaveLargeCookie: 'Отримано велике печиво!',
      notInDemo: 'Ви не в Demo Mode!',
      exitDemo: 'Вихід з Demo Mode',
      notInKeyMenu: 'Не в меню з ключами!',
      autoPassKey: 'Auto passing key to registration',
      invalidTimeFormat: 'Невірний формат часу!',
      demoTimeSet: 'Demo time set to {time}',
      demoTimeInfinity: 'Demo time set to infinity',
      questsTitle: 'Завдання',
      questCompleted: '✅',
      questNotCompleted: '❌',
      takeQuest: 'Взяти',
      cancelQuest: 'Зняти',
      activeQuest: 'У вас вже є активне завдання!',
      questCancelled: 'Завдання скасовано!',
      questTimeExpired: 'Час на завдання минув! Завдання провалено.',
      questCompletedSuccess: 'Завдання виконано! Нагорода: {reward} грошей.',
      currentQuest: 'Поточне завдання: наклікати {clicks}/{required} кліків за {remaining} секунд',
      settingsTitle: 'Налаштування',
      uiScaleLabel: 'Розмір інтерфейсу:',
      smallScale: 'Маленький',
      mediumScale: 'Середній',
      largeScale: 'Великий',
      languageLabel: 'Мова:',
      russian: 'Російська',
      english: 'Англійська',
      ukrainian: 'Українська',
      apply: 'Застосувати',
      achievementUnlocked: 'Досягнення розблоковано: {name}\nВітаємо! Ви досягли {amount} кліків.',
      promoDisabledInDemo: 'Промокоди недоступні в Demo Mode',
      demoTimerInfinity: 'Залишився час: Infinity',
      questDescTemplate: 'досягти {required} кліків за {time} секунд'
    }
  };

  function init() {
    var storedKeys = localStorage.getItem('clickerKeys');
    if (storedKeys) {
      keys = JSON.parse(storedKeys);
    } else {
var encoded_keys = {
  // 🔹 Старые ключи
  '2025-10-01': 'TFlTVUtBLUtPVC0x',        // LYSUKA-KOT-1
  '2025-10-02': 'TFlTVUtBLUtPVC0xMjM=',     // LYSUKA-KOT-123
  '2025-10-03': 'TFlTVUtBLUtPVC0xMjM0',     // LYSUKA-KOT-1234
  '2025-10-04': 'TFlTVUtBLUtPVC0xMjM1',     // LYSUKA-KOT-1235
  '2025-10-05': 'TFlTVUtBLUtPVC0xMjQz',     // LYSUKA-KOT-1243
  '2025-10-06': 'TFlTVUtBLUtPVC01NDMyMQ==', // LYSUKA-KOT-54321
  '2025-10-07': 'TFlTVUtBLUtPVC00NTc2',     // LYSUKA-KOT-4576
  '2025-10-08': 'TFlTVUtBLUtPVC04Mzc0',     // LYSUKA-KOT-8374
  '2025-10-09': 'TFlTVUtBLUtPVC05MTM1',     // LYSUKA-KOT-9135
  '2025-10-10': 'TFlTVUtBLUtPVC0xMA==',     // LYSUKA-KOT-10

  // 🔹 Новые ключи (с 24.10.2025 по 23.11.2025)
  '2025-10-24': 'TFlTVUtBLUtPVC0xNzk=',   // LYSUKA-KOT-179
  '2025-10-25': 'TFlTVUtBLUtPVC00NzU=',   // LYSUKA-KOT-475
  '2025-10-26': 'TFlTVUtBLUtPVC01MTk=',   // LYSUKA-KOT-519
  '2025-10-27': 'TFlTVUtBLUtPVC05Mzg=',   // LYSUKA-KOT-938
  '2025-10-28': 'TFlTVUtBLUtPVC04NDM=',   // LYSUKA-KOT-843
  '2025-10-29': 'TFlTVUtBLUtPVC0xMzA5',   // LYSUKA-KOT-1309
  '2025-10-30': 'TFlTVUtBLUtPVC01Mzc=',   // LYSUKA-KOT-537
  '2025-10-31': 'TFlTVUtBLUtPVC00ODEw',   // LYSUKA-KOT-4810
  '2025-11-01': 'TFlTVUtBLUtPVC03MTA=',   // LYSUKA-KOT-710
  '2025-11-02': 'TFlTVUtBLUtPVC0zOTU=',   // LYSUKA-KOT-395
  '2025-11-03': 'TFlTVUtBLUtPVC03MDQ4',   // LYSUKA-KOT-7048
  '2025-11-04': 'TFlTVUtBLUtPVC05ODU=',   // LYSUKA-KOT-985
  '2025-11-05': 'TFlTVUtBLUtPVC0xODM5',   // LYSUKA-KOT-1839
  '2025-11-06': 'TFlTVUtBLUtPVC01Mzkx',   // LYSUKA-KOT-5391
  '2025-11-07': 'TFlTVUtBLUtPVC05MTA3',   // LYSUKA-KOT-9107
  '2025-11-08': 'TFlTVUtBLUtPVC04NTQ=',   // LYSUKA-KOT-854
  '2025-11-09': 'TFlTVUtBLUtPVC0zOTEw',   // LYSUKA-KOT-3910
  '2025-11-10': 'TFlTVUtBLUtPVC01NDA=',   // LYSUKA-KOT-540
  '2025-11-11': 'TFlTVUtBLUtPVC05ODM=',   // LYSUKA-KOT-983
  '2025-11-12': 'TFlTVUtBLUtPVC0xODc=',   // LYSUKA-KOT-187
  '2025-11-13': 'TFlTVUtBLUtPVC0zNTc=',   // LYSUKA-KOT-357
  '2025-11-14': 'TFlTVUtBLUtPVC03NDE=',   // LYSUKA-KOT-741
  '2025-11-15': 'TFlTVUtBLUtPVC0xOTM4',   // LYSUKA-KOT-1938
  '2025-11-16': 'TFlTVUtBLUtPVC01ODA=',   // LYSUKA-KOT-580
  '2025-11-17': 'TFlTVUtBLUtPVC03MTk=',   // LYSUKA-KOT-719
  '2025-11-18': 'TFlTVUtBLUtPVC04NDUz',   // LYSUKA-KOT-8453
  '2025-11-19': 'TFlTVUtBLUtPVC00MDc=',   // LYSUKA-KOT-407
  '2025-11-20': 'TFlTVUtBLUtPVC05MzE=',   // LYSUKA-KOT-931
  '2025-11-21': 'TFlTVUtBLUtPVC0xODA=',   // LYSUKA-KOT-180
  '2025-11-22': 'TFlTVUtBLUtPVC03NTk=',   // LYSUKA-KOT-759
  '2025-11-23': 'TFlTVUtBLUtPVC04Nzc=',   // LYSUKA-KOT-877
};

      keys = {};
      for (var date in encoded_keys) {
        keys[date] = atob(encoded_keys[date]);
      }
      localStorage.setItem('clickerKeys', JSON.stringify(keys));
    }
    document.getElementById('keyContainer').style.display = 'block';
    document.getElementById('authContainer').style.display = 'none';
    document.getElementById('loadingScreen').display = 'none';
    document.getElementById('gameScreen').style.display = 'none';
    document.addEventListener('keydown', function(event) {
      if (event.key === 'f' || event.key === 'F') {
        toggleConsole();
      }
    });
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape' && document.getElementById('gameScreen').style.display !== 'none' && !isPaused) {
        pauseGame();
      } else if (event.key === 'Escape' && isPaused) {
        resumeGame();
      }
    });
    // Apply saved UI scale
    var savedScale = localStorage.getItem('uiScale') || '1';
    document.body.style.transform = `scale(${savedScale})`;
    document.body.style.transformOrigin = '0 0';
    document.body.style.width = `${100 / parseFloat(savedScale)}%`;
    document.body.style.height = `${100 / parseFloat(savedScale)}%`;

    // Apply language
    applyStaticTexts();
    updateQuestDescriptions();
  }

  function applyStaticTexts() {
    var t = translations[currentLanguage];
    document.title = t.title;
    document.getElementById('enterKeyTitle').innerText = t.enterKeyTitle;
    document.getElementById('inputText').placeholder = t.enterKeyPlaceholder;
    document.getElementById('submitKeyButton').innerText = t.submitKeyButton;
    document.getElementById('exitKeyButton').innerText = t.exitKeyButton;
    document.getElementById('demoModeButton').innerText = t.demoModeButton;
    document.getElementById('loginTitle').innerText = t.loginTitle;
    document.getElementById('loginUsername').placeholder = t.usernamePlaceholder;
    document.getElementById('loginPassword').placeholder = t.passwordPlaceholder;
    document.getElementById('loginButton').innerText = t.loginButton;
    document.getElementById('noAccountText').innerText = t.noAccountText;
    document.getElementById('registerLink').innerText = t.registerLink;
    document.getElementById('registerTitle').innerText = t.registerTitle;
    document.getElementById('regUsername').placeholder = t.usernamePlaceholder;
    document.getElementById('regPassword').placeholder = t.passwordPlaceholder;
    document.getElementById('registerButton').innerText = t.registerButton;
    document.getElementById('backButton').innerText = t.backButton;
    document.getElementById('shopButton').innerText = t.shopButton;
    document.getElementById('inventoryButton').innerText = t.inventoryButton;
    document.getElementById('questsButton').innerText = t.questsButton;
    document.getElementById('clickButton').innerText = t.clickButton;
    document.getElementById('achievementsButton').innerText = t.achievementsButton;
    document.getElementById('promoButton').innerText = t.promoButton;
    document.getElementById('exitButton').innerText = t.exitButton;
    document.getElementById('pauseTitle').innerText = t.pauseTitle;
    document.getElementById('resumeButton').innerText = t.resumeButton;
    document.getElementById('settingsButton').innerText = t.settingsButton;
    document.getElementById('logoutButton').innerText = t.logoutButton;
  }

  function setLanguage(lang) {
    if (lang !== currentLanguage) {
      currentLanguage = lang;
      localStorage.setItem('language', lang);
      updateAllUI();
    }
  }

  function updateAllUI() {
    var t = translations[currentLanguage];
    applyStaticTexts();
    updateQuestDescriptions();

    if (document.getElementById('gameScreen').style.display !== 'none') {
      updateLevel();
      updateMoney();
      updateCounter();
      updateCurrentQuest();
    }

    // Update demo elements if in demo
    var demoLabel = document.getElementById('demoLabel');
    if (demoLabel) {
      demoLabel.innerText = t.demoLabel;
    }
    var demoTimer = document.getElementById('demoTimer');
    if (demoTimer) {
      if (isInfiniteDemo) {
        demoTimer.innerText = t.demoTimerInfinity;
      } else {
        updateDemoTimer();
      }
    }

    // Re-render open menus
    if (document.getElementById('shopMenu').style.display === 'block') {
      renderShop();
    }
    if (document.getElementById('inventoryMenu').style.display === 'block') {
      renderInventory();
    }
    if (document.getElementById('adminMenu').style.display === 'block') {
      renderAdminPanel();
    }
    if (document.getElementById('issueClicksMenu').style.display === 'block') {
      showIssueClicks();
    }
    if (document.getElementById('issueCookieMenu').style.display === 'block') {
      showIssueCookie();
    }
    if (document.getElementById('issueAchievementMenu').style.display === 'block') {
      showIssueAchievement();
    }
    if (document.getElementById('blockedMenu').style.display === 'block') {
      renderBlocked();
    }
    if (document.getElementById('achievementsMenu').style.display === 'block') {
      renderAchievements();
    }
    if (document.getElementById('promoMenu').style.display === 'block') {
      renderPromo();
    }
    if (document.getElementById('demoExpiredMenu').style.display === 'block') {
      renderDemoExpired();
    }
    if (document.getElementById('consoleMenu').style.display === 'block') {
      renderConsole();
    }
    if (document.getElementById('questsMenu').style.display === 'block') {
      renderQuests();
    }
    if (document.getElementById('settingsMenu').style.display === 'block') {
      renderSettings();
    }
  }

  function showMsg(id, msg, success) {
    var elem = document.getElementById(id);
    elem.innerText = msg;
    elem.style.color = success ? 'green' : 'red';
  }

  function showRegister() {
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('registerScreen').style.display = 'block';
    document.getElementById('loginMsg').innerText = '';
  }

  function showLogin() {
    document.getElementById('registerScreen').style.display = 'none';
    document.getElementById('loginScreen').style.display = 'block';
    document.getElementById('registerMsg').innerText = '';
  }

  function enterDemoMode() {
    isDemo = true;
    demoUser = {
      count: "0",
      money: "0",
      internal_level: 0,
      has_small_cookie: 0,
      equipped_small_cookie: 0,
      has_medium_cookie: 0,
      equipped_medium_cookie: 0,
      has_large_cookie: 0,
      equipped_large_cookie: 0,
      is_blocked: 0,
      achieved_100: 0,
      achieved_500: 0,
      achieved_1000: 0,
      achieved_3000: 0,
      achieved_5000: 0,
      achieved_10000: 0,
      active_quest: null,
      completed_quests: []
    };
    currentUsername = 'Demo';
    count = 0;
    money = 0;
    internal_level = 0;
    document.getElementById('keyContainer').classList.add('fade-out');
    setTimeout(() => {
      document.getElementById('keyContainer').style.display = 'none';
      showGame();
    }, 500);
  }

  function dragElement(el) {
    var pos1 = 0,
      pos2 = 0,
      pos3 = 0,
      pos4 = 0;
    el.querySelector('h3').onpointerdown = function() {
      dragMouseDown();
    };

    function dragMouseDown(e) {
      e = e || window.event;
      e.preventDefault();
      pos3 = e.clientX;
      pos4 = e.clientY;

      document.onpointerup = closeDragElement;
      document.onpointermove = elementDrag;
    }

    function elementDrag(e) {
      e = e || window.event;
      e.preventDefault();
      pos1 = pos3 - e.clientX;
      pos2 = pos4 - e.clientY;
      pos3 = e.clientX;
      pos4 = e.clientY;

      el.style.top = el.offsetTop - pos2 + 'px';
      el.style.left = el.offsetLeft - pos1 + 'px';
    }

    function closeDragElement() {
      document.onpointerup = null;
      document.onpointermove = null;
    }
  }

  function trim(str) {
    return str.replace(/^\s+|\s+$/g, '');
  }

  function checkKey() {
    var t = translations[currentLanguage];
    var currentDate = new Date().toISOString().split('T')[0];
    var enteredKey = trim(document.getElementById('inputText').value);
    var expectedKey = keys[currentDate];
    if (!expectedKey) {
      alert(t.keyNoDate);
      return;
    }
    if (enteredKey === expectedKey) {
      alert(t.keyCorrect);
      document.getElementById('keyContainer').classList.add('fade-out');
      setTimeout(() => {
        document.getElementById('keyContainer').style.display = 'none';
        document.getElementById('authContainer').style.display = 'block';
        setTimeout(() => {
          document.getElementById('authContainer').classList.add('fade-in');
        }, 10);
      }, 500);
    } else {
      alert(t.keyIncorrect);
    }
  }

  var quests = [
    { id: 1, clicksRequired: 50, timeLimit: 60, reward: 100, description: '' },
    { id: 2, clicksRequired: 100, timeLimit: 120, reward: 200, description: '' },
    { id: 3, clicksRequired: 200, timeLimit: 180, reward: 300, description: '' }
  ];

  var questStartTime = 0;
  var questClicks = 0;
  var questTimerInterval = null;

  function updateQuestDescriptions() {
    var t = translations[currentLanguage];
    quests.forEach(function(quest) {
      quest.description = t.questDescTemplate.replace('{required}', quest.clicksRequired).replace('{time}', quest.timeLimit);
    });
  }

  function formatInternalLevel(level) {
    return (level / 100).toFixed(2);
  }

  function showLoading() {
    var t = translations[currentLanguage];
    document.getElementById('authContainer').classList.remove('fade-in');
    setTimeout(() => {
      document.getElementById('authContainer').style.display = 'none';
      document.getElementById('loadingScreen').style.display = 'block';
      document.getElementById('loadingScreen').classList.add('visible');
    }, 500);
    var dots = 0;
    var loadingInterval = setInterval(function() {
      dots = (dots + 1) % 4; // Cycle from 0 to 3
      var text = t.loadingText;
      for (var i = 0; i < dots; i++) {
        text += '.';
      }
      document.getElementById('loadingText').innerText = text;
    }, 500); // Change every 0.5 seconds

    setTimeout(function() {
      clearInterval(loadingInterval); // Stop animation
      showGame();
    }, 5000);
  }

  function showBlocked() {
    renderBlocked();
    document.getElementById('authContainer').style.display = 'none';
    document.getElementById('blockedMenu').style.display = 'block';
    setTimeout(() => { document.getElementById('blockedMenu').classList.add('open'); }, 10);
    dragElement(document.getElementById('blockedMenu'));
  }

  function renderBlocked() {
    var t = translations[currentLanguage];
    var content = '<h3>' + t.blockedTitle + '</h3>';
    content += '<p>' + t.blockedText + '</p>';
    content += '<button onclick="doLogout()">' + t.logoutButton + '</button>';
    document.getElementById('blockedMenu').innerHTML = content;
  }

  function showGame() {
    var t = translations[currentLanguage];
    document.getElementById('loadingScreen').style.display = 'none';
    document.getElementById('gameScreen').style.display = 'block';
    setTimeout(() => { document.getElementById('gameScreen').classList.add('visible'); }, 10);
    var user = getCurrentUser();
    if (user) {
      count = parseFloat(user.count) || 0;
      money = parseFloat(user.money) || 0;
      internal_level = user.level || 0;
      updateCounter();
      updateMoney();
      updateLevel();
      updateCurrentQuest();
      if (user.active_quest !== null) {
        startQuestTimer();
        startQuestUpdateInterval();
      }
    } else {
      alert(t.userNotFoundAlert);
    }

    // Remove admin button if exists
    var existingAdminButton = document.getElementById('adminButton');
    if (existingAdminButton) {
      existingAdminButton.parentNode.removeChild(existingAdminButton);
    }

    // Add admin button only for Admin
    if (currentUsername === 'Admin') {
      var adminButton = document.createElement('button');
      adminButton.id = 'adminButton';
      adminButton.innerText = t.adminPanelTitle;
      adminButton.onclick = showAdminPanel;
      adminButton.style.position = 'absolute';
      adminButton.style.top = '0px';
      adminButton.style.right = '10px';
      adminButton.style.fontSize = '16px';
      adminButton.style.padding = '8px 16px';
      adminButton.style.backgroundColor = '#FF00FF'; // Magenta for admin
      document.getElementById('gameScreen').appendChild(adminButton);
    }

    // Remove demo elements if exist
    var existingDemoLabel = document.getElementById('demoLabel');
    if (existingDemoLabel) {
      existingDemoLabel.parentNode.removeChild(existingDemoLabel);
    }
    var existingDemoTimer = document.getElementById('demoTimer');
    if (existingDemoTimer) {
      existingDemoTimer.parentNode.removeChild(existingDemoTimer);
    }

    // Reset positions to default every time
    document.getElementById('shopButton').style.top = '0px';
    document.getElementById('inventoryButton').style.top = '40px';
    document.getElementById('questsButton').style.top = '80px';

    // Reset promo button to default
    document.getElementById('promoButton').disabled = false;
    document.getElementById('promoButton').style.backgroundColor = '#2196F3';
    document.getElementById('promoButton').onclick = showPromo;

    if (isDemo) {
      var demoLabel = document.createElement('div');
      demoLabel.id = 'demoLabel';
      demoLabel.innerText = t.demoLabel;
      demoLabel.style.position = 'absolute';
      demoLabel.style.top = '10px';
      demoLabel.style.left = '10px';
      demoLabel.style.color = 'blue';
      demoLabel.style.fontSize = '18px';
      demoLabel.style.fontWeight = 'bold';
      document.getElementById('gameScreen').appendChild(demoLabel);

      var demoTimer = document.createElement('div');
      demoTimer.id = 'demoTimer';
      demoTimer.style.position = 'absolute';
      demoTimer.style.top = '40px';
      demoTimer.style.left = '10px';
      demoTimer.style.color = 'red';
      demoTimer.style.fontSize = '16px';
      demoTimer.style.fontWeight = 'bold';
      document.getElementById('gameScreen').appendChild(demoTimer);
      updateDemoTimer();
      if (!isInfiniteDemo) {
        demoTimerInterval = setInterval(updateDemoTimer, 1000);
      } else {
        document.getElementById('demoTimer').innerText = t.demoTimerInfinity;
      }

      // Shift buttons down
      document.getElementById('shopButton').style.top = '60px';
      document.getElementById('inventoryButton').style.top = '100px';
      document.getElementById('questsButton').style.top = '140px';

      // Disable promo in demo
      document.getElementById('promoButton').disabled = true;
      document.getElementById('promoButton').style.backgroundColor = 'gray';
      document.getElementById('promoButton').onclick = function() { alert(t.promoDisabledInDemo); };
    }
  }

  function updateDemoTimer() {
    var t = translations[currentLanguage];
    if (demoTimeLeft <= 0) {
      clearInterval(demoTimerInterval);
      showDemoExpired();
      return;
    }
    var minutes = Math.floor(demoTimeLeft / 60);
    var seconds = demoTimeLeft % 60;
    document.getElementById('demoTimer').innerText = t.demoTimer + minutes + ':' + (seconds < 10 ? '0' : '') + seconds;
    demoTimeLeft--;
  }

  function showDemoExpired() {
    renderDemoExpired();
    document.getElementById('demoExpiredMenu').style.display = 'block';
    setTimeout(() => { document.getElementById('demoExpiredMenu').classList.add('open'); }, 10);
    dragElement(document.getElementById('demoExpiredMenu'));
    // Hide game screen
    document.getElementById('gameScreen').classList.remove('visible');
    setTimeout(() => { document.getElementById('gameScreen').style.display = 'none'; }, 500);
    demoJustExpired = true;
  }

  function renderDemoExpired() {
    var t = translations[currentLanguage];
    var content = '<h3>' + t.demoExpiredTitle + '</h3>';
    content += '<p>' + t.demoExpiredText + '</p>';
    content += '<button onclick="returnToKey()">' + t.ok + '</button>';
    document.getElementById('demoExpiredMenu').innerHTML = content;
  }

  function returnToKey() {
    document.getElementById('demoExpiredMenu').classList.remove('open');
    setTimeout(() => { document.getElementById('demoExpiredMenu').style.display = 'none'; }, 500);
    document.getElementById('gameScreen').classList.remove('visible');
    setTimeout(() => { document.getElementById('gameScreen').style.display = 'none'; }, 500);
    document.getElementById('keyContainer').style.display = 'block';
    document.getElementById('keyContainer').style.opacity = '1';
    document.getElementById('keyContainer').style.transform = 'translateY(0)';
    document.getElementById('keyContainer').classList.remove('fade-out');
    document.getElementById('authContainer').style.display = 'none';
    document.getElementById('authContainer').classList.remove('fade-in');
    isDemo = false;
    demoUser = null;
    currentUsername = '';
    count = 0;
    money = 0;
    internal_level = 0;
    if (demoTimerInterval) clearInterval(demoTimerInterval);
    isInfiniteDemo = false;
  }

  function updateCounter() {
    var t = translations[currentLanguage];
    document.getElementById('counter').innerText = t.counter + count;
  }

  function updateMoney() {
    var t = translations[currentLanguage];
    document.getElementById('money').innerText = t.money + money;
  }

  function updateLevel() {
    var t = translations[currentLanguage];
    document.getElementById('level').innerText = t.level + formatInternalLevel(internal_level);
  }

  function showShop() {
    renderShop();
    document.getElementById('shopMenu').style.display = 'block';
    setTimeout(() => { document.getElementById('shopMenu').classList.add('open'); }, 10);
    dragElement(document.getElementById('shopMenu'));
  }

  function renderShop() {
    var t = translations[currentLanguage];
    var user = getCurrentUser();
    var content = '<h3>' + t.shopTitle + '</h3>';
    content += '<p>' + t.smallCookie + ' - 300 clicks</p>';
    if (!user.has_small_cookie) {
      content += '<button onclick="buySmallCookie()">' + t.buy + '</button>';
    } else {
      content += '<p>' + t.bought + '</p>';
    }
    content += '<p>' + t.mediumCookie + ' - 700 clicks</p>';
    if (!user.has_medium_cookie) {
      content += '<button onclick="buyMediumCookie()">' + t.buy + '</button>';
    } else {
      content += '<p>' + t.bought + '</p>';
    }
    content += '<p>' + t.largeCookie + ' - 1000 clicks</p>';
    if (!user.has_large_cookie) {
      content += '<button onclick="buyLargeCookie()">' + t.buy + '</button>';
    } else {
      content += '<p>' + t.bought + '</p>';
    }
    content += '<br><button onclick="closeShop()">' + t.close + '</button>';
    document.getElementById('shopMenu').innerHTML = content;
  }

  function closeShop() {
    document.getElementById('shopMenu').classList.remove('open');
    setTimeout(() => { document.getElementById('shopMenu').style.display = 'none'; }, 500); // Longer transition
  }

  async function buySmallCookie() {
    const t = translations[currentLanguage];
    if (count >= 300) {
      count -= 300;
      if (isDemo) {
        demoUser.count = count;
        demoUser.has_small_cookie = 1;
      } else {
        userData.count = count;
        userData.has_small_cookie = 1;
        await update(ref(db, 'users/' + currentUid), { count: count, has_small_cookie: 1 });
      }
      updateCounter();
      alert(t.boughtSuccess);
      renderShop();
    } else {
      alert(t.notEnoughClicks);
    }
  }

  async function buyMediumCookie() {
    const t = translations[currentLanguage];
    if (count >= 700) {
      count -= 700;
      if (isDemo) {
        demoUser.count = count;
        demoUser.has_medium_cookie = 1;
      } else {
        userData.count = count;
        userData.has_medium_cookie = 1;
        await update(ref(db, 'users/' + currentUid), { count: count, has_medium_cookie: 1 });
      }
      updateCounter();
      alert(t.boughtSuccess);
      renderShop();
    } else {
      alert(t.notEnoughClicks);
    }
  }

  async function buyLargeCookie() {
    const t = translations[currentLanguage];
    if (count >= 1000) {
      count -= 1000;
      if (isDemo) {
        demoUser.count = count;
        demoUser.has_large_cookie = 1;
      } else {
        userData.count = count;
        userData.has_large_cookie = 1;
        await update(ref(db, 'users/' + currentUid), { count: count, has_large_cookie: 1 });
      }
      updateCounter();
      alert(t.boughtSuccess);
      renderShop();
    } else {
      alert(t.notEnoughClicks);
    }
  }

  function showInventory() {
    renderInventory();
    document.getElementById('inventoryMenu').style.display = 'block';
    setTimeout(() => { document.getElementById('inventoryMenu').classList.add('open'); }, 10);
    dragElement(document.getElementById('inventoryMenu'));
  }

  function renderInventory() {
    var t = translations[currentLanguage];
    var user = getCurrentUser();
    var content = '<h3>' + t.inventoryTitle + '</h3>';
    var hasItems = false;
    if (user.has_small_cookie) {
      hasItems = true;
      content += '<p>' + t.smallCookie;
      if (user.equipped_small_cookie) {
        content += t.equipped + ' <button onclick="unequipSmallCookie()">' + t.unequip + '</button>';
      } else {
        content += ' <button onclick="equipSmallCookie()">' + t.equip + '</button>';
      }
      content += '</p>';
    }
    if (user.has_medium_cookie) {
      hasItems = true;
      content += '<p>' + t.mediumCookie;
      if (user.equipped_medium_cookie) {
        content += t.equipped + ' <button onclick="unequipMediumCookie()">' + t.unequip + '</button>';
      } else {
        content += ' <button onclick="equipMediumCookie()">' + t.equip + '</button>';
      }
      content += '</p>';
    }
    if (user.has_large_cookie) {
      hasItems = true;
      content += '<p>' + t.largeCookie;
      if (user.equipped_large_cookie) {
        content += t.equipped + ' <button onclick="unequipLargeCookie()">' + t.unequip + '</button>';
      } else {
        content += ' <button onclick="equipLargeCookie()">' + t.equip + '</button>';
      }
      content += '</p>';
    }
    if (!hasItems) {
      content += '<p>' + t.inventoryEmpty + '</p>';
    }
    content += '<button onclick="closeInventory()">' + t.close + '</button>';
    document.getElementById('inventoryMenu').innerHTML = content;
  }

  function closeInventory() {
    document.getElementById('inventoryMenu').classList.remove('open');
    setTimeout(() => { document.getElementById('inventoryMenu').style.display = 'none'; }, 500);
  }

  async function equipSmallCookie() {
    if (isDemo) {
      demoUser.equipped_small_cookie = 1;
    } else {
      userData.equipped_small_cookie = 1;
      await update(ref(db, 'users/' + currentUid), { equipped_small_cookie: 1 });
    }
    renderInventory();
  }

  async function unequipSmallCookie() {
    if (isDemo) {
      demoUser.equipped_small_cookie = 0;
    } else {
      userData.equipped_small_cookie = 0;
      await update(ref(db, 'users/' + currentUid), { equipped_small_cookie: 0 });
    }
    renderInventory();
  }

  async function equipMediumCookie() {
    if (isDemo) {
      demoUser.equipped_medium_cookie = 1;
    } else {
      userData.equipped_medium_cookie = 1;
      await update(ref(db, 'users/' + currentUid), { equipped_medium_cookie: 1 });
    }
    renderInventory();
  }

  async function unequipMediumCookie() {
    if (isDemo) {
      demoUser.equipped_medium_cookie = 0;
    } else {
      userData.equipped_medium_cookie = 0;
      await update(ref(db, 'users/' + currentUid), { equipped_medium_cookie: 0 });
    }
    renderInventory();
  }

  async function equipLargeCookie() {
    if (isDemo) {
      demoUser.equipped_large_cookie = 1;
    } else {
      userData.equipped_large_cookie = 1;
      await update(ref(db, 'users/' + currentUid), { equipped_large_cookie: 1 });
    }
    renderInventory();
  }

  async function unequipLargeCookie() {
    if (isDemo) {
      demoUser.equipped_large_cookie = 0;
    } else {
      userData.equipped_large_cookie = 0;
      await update(ref(db, 'users/' + currentUid), { equipped_large_cookie: 0 });
    }
    renderInventory();
  }

  function showAdminPanel() {
    renderAdminPanel();
    document.getElementById('adminMenu').style.display = 'block';
    setTimeout(() => { document.getElementById('adminMenu').classList.add('open'); }, 10);
    dragElement(document.getElementById('adminMenu'));
  }

  function renderAdminPanel() {
    var t = translations[currentLanguage];
    var content = '<h3>' + t.adminPanelTitle + '</h3>';
    content += '<input id="targetUsername" type="text" placeholder="' + t.targetUsernamePlaceholder + '" />';
    content += '<br><button onclick="showIssueClicks()">' + t.issueClicks + '</button><br>';
    content += '<button onclick="showIssueCookie()">' + t.issueCookie + '</button><br>';
    content += '<button onclick="showIssueAchievement()">' + t.issueAchievement + '</button><br>';
    content += '<button onclick="blockAccount()">' + t.block + '</button>';
    content += '<button onclick="unblockAccount()" style="margin-left:10px;">' + t.unblock + '</button><br>';
    content += '<button onclick="resetCount()">' + t.resetClicks + '</button><br>';
    content += '<button onclick="closeAdminPanel()">' + t.close + '</button>';
    document.getElementById('adminMenu').innerHTML = content;
  }

  function closeAdminPanel() {
    document.getElementById('adminMenu').classList.remove('open');
    setTimeout(() => { document.getElementById('adminMenu').style.display = 'none'; }, 500);
  }

  function showIssueClicks() {
    var t = translations[currentLanguage];
    var content = '<h3>' + t.issueClicksTitle + '</h3>';
    content += '<input id="clickAmount" type="number" placeholder="' + t.clickAmountPlaceholder + '" />';
    content += '<br><button onclick="confirmIssueClicks()">' + t.issue + '</button>';
    content += '<button onclick="closeIssueClicks()">' + t.close + '</button>';
    document.getElementById('issueClicksMenu').innerHTML = content;
    document.getElementById('issueClicksMenu').style.display = 'block';
    setTimeout(() => { document.getElementById('issueClicksMenu').classList.add('open'); }, 10);
    dragElement(document.getElementById('issueClicksMenu'));
  }

  function closeIssueClicks() {
    document.getElementById('issueClicksMenu').classList.remove('open');
    setTimeout(() => { document.getElementById('issueClicksMenu').style.display = 'none'; }, 500);
  }

  function showIssueCookie() {
    var t = translations[currentLanguage];
    var content = '<h3>' + t.issueCookieTitle + '</h3>';
    content += '<button onclick="confirmIssueCookie(1)">' + t.small + '</button>';
    content += '<button onclick="confirmIssueCookie(2)">' + t.medium + '</button>';
    content += '<button onclick="confirmIssueCookie(3)">' + t.large + '</button>';
    content += '<br><button onclick="closeIssueCookie()">' + t.close + '</button>';
    document.getElementById('issueCookieMenu').innerHTML = content;
    document.getElementById('issueCookieMenu').style.display = 'block';
    setTimeout(() => { document.getElementById('issueCookieMenu').classList.add('open'); }, 10);
    dragElement(document.getElementById('issueCookieMenu'));
  }

  function closeIssueCookie() {
    document.getElementById('issueCookieMenu').classList.remove('open');
    setTimeout(() => { document.getElementById('issueCookieMenu').style.display = 'none'; }, 500);
  }

  function showIssueAchievement() {
    var t = translations[currentLanguage];
    var content = '<h3>' + t.issueAchievementTitle + '</h3>';
    content += '<button onclick="confirmIssueAchievement(1)">' + t.achievement100 + '</button>';
    content += '<button onclick="confirmIssueAchievement(2)">' + t.achievement500 + '</button>';
    content += '<button onclick="confirmIssueAchievement(3)">' + t.achievement1000 + '</button>';
    content += '<button onclick="confirmIssueAchievement(4)">' + t.achievement3000 + '</button>';
    content += '<button onclick="confirmIssueAchievement(5)">' + t.achievement5000 + '</button>';
    content += '<button onclick="confirmIssueAchievement(6)">' + t.achievement10000 + '</button>';
    content += '<br><button onclick="closeIssueAchievement()">' + t.close + '</button>';
    document.getElementById('issueAchievementMenu').innerHTML = content;
    document.getElementById('issueAchievementMenu').style.display = 'block';
    setTimeout(() => { document.getElementById('issueAchievementMenu').classList.add('open'); }, 10);
    dragElement(document.getElementById('issueAchievementMenu'));
  }

  function closeIssueAchievement() {
    document.getElementById('issueAchievementMenu').classList.remove('open');
    setTimeout(() => { document.getElementById('issueAchievementMenu').style.display = 'none'; }, 500);
  }

  async function getTargetUser() {
    var t = translations[currentLanguage];
    var target = trim(document.getElementById('targetUsername').value);
    if (target === '') {
      alert(t.enterUsername);
      return null;
    }
    if (isDemo && target === 'Demo') {
      return 'Demo'; // Special handling for demo
    }
    const user = await getUserByUsername(target);
    if (!user) {
      alert(t.userNotFound);
      return null;
    }
    return target;
  }

  async function getUser(target) {
    if (isDemo && target === 'Demo') {
      return demoUser;
    }
    return await getUserByUsername(target);
  }

  async function confirmIssueClicks() {
    var t = translations[currentLanguage];
    var target = await getTargetUser();
    if (target) {
      var amountStr = document.getElementById('clickAmount').value;
      var amount = parseInt(amountStr);
      if (isNaN(amount) || amount <= 0) {
        alert(t.invalidAmount);
        return;
      }
      var user = await getUser(target);
      var currentCount = parseFloat(user.count) || 0;
      var newCount = currentCount + amount;
      var uid = await getUidByUsername(target);
      await update(ref(db, 'users/' + uid), { count: newCount });
      checkAchievements(target);
      alert(t.issuedClicks.replace('{amount}', amount).replace('{target}', target));
      if (target === currentUsername) {
        count = newCount;
        updateCounter();
      }
      closeIssueClicks();
    }
  }

  async function confirmIssueCookie(choice) {
    var t = translations[currentLanguage];
    var target = await getTargetUser();
    if (target) {
      var uid = await getUidByUsername(target);
      var updates = {};
      if (choice === 1) {
        updates.has_small_cookie = 1;
        alert(t.issuedCookieSmall.replace('{target}', target));
      } else if (choice === 2) {
        updates.has_medium_cookie = 1;
        alert(t.issuedCookieMedium.replace('{target}', target));
      } else if (choice === 3) {
        updates.has_large_cookie = 1;
        alert(t.issuedCookieLarge.replace('{target}', target));
      }
      await update(ref(db, 'users/' + uid), updates);
      if (target === currentUsername) {
        Object.assign(userData, updates);
      }
      closeIssueCookie();
    }
  }

  async function confirmIssueAchievement(choice) {
    var t = translations[currentLanguage];
    var target = await getTargetUser();
    if (target) {
      var uid = await getUidByUsername(target);
      var updates = {};
      var name;
      if (choice === 1) {
        updates.achieved_100 = 1;
        name = t.achievement100;
      } else if (choice === 2) {
        updates.achieved_500 = 1;
        name = t.achievement500;
      } else if (choice === 3) {
        updates.achieved_1000 = 1;
        name = t.achievement1000;
      } else if (choice === 4) {
        updates.achieved_3000 = 1;
        name = t.achievement3000;
      } else if (choice === 5) {
        updates.achieved_5000 = 1;
        name = t.achievement5000;
      } else if (choice === 6) {
        updates.achieved_10000 = 1;
        name = t.achievement10000;
      }
      await update(ref(db, 'users/' + uid), updates);
      alert(t.issuedAchievement.replace('{name}', name).replace('{target}', target));
      if (target === currentUsername) {
        Object.assign(userData, updates);
      }
      closeIssueAchievement();
    }
  }

  async function blockAccount() {
    var t = translations[currentLanguage];
    var target = await getTargetUser();
    if (target) {
      var uid = await getUidByUsername(target);
      await update(ref(db, 'users/' + uid), { is_blocked: 1 });
      alert(t.blocked.replace('{target}', target));
    }
  }

  async function unblockAccount() {
    var t = translations[currentLanguage];
    var target = await getTargetUser();
    if (target) {
      var uid = await getUidByUsername(target);
      await update(ref(db, 'users/' + uid), { is_blocked: 0 });
      alert(t.unblocked.replace('{target}', target));
    }
  }

  async function resetCount() {
    var t = translations[currentLanguage];
    var target = await getTargetUser();
    if (target) {
      var uid = await getUidByUsername(target);
      await update(ref(db, 'users/' + uid), {
        count: 0,
        achieved_100: 0,
        achieved_500: 0,
        achieved_1000: 0,
        achieved_3000: 0,
        achieved_5000: 0,
        achieved_10000: 0
      });
      alert(t.clicksReset.replace('{target}', target));
      if (target === currentUsername) {
        count = 0;
        userData.count = 0;
        userData.achieved_100 = 0;
        userData.achieved_500 = 0;
        userData.achieved_1000 = 0;
        userData.achieved_3000 = 0;
        userData.achieved_5000 = 0;
        userData.achieved_10000 = 0;
        updateCounter();
      }
    }
  }

  async function doLogout() {
    var t = translations[currentLanguage];
    if (currentUsername && !isDemo) {
      await update(ref(db, 'users/' + currentUid), {
        count: count,
        money: money,
        level: internal_level
      });
    }
    currentUsername = '';
    count = 0;
    money = 0;
    internal_level = 0;
    userData = null;
    currentUid = null;
    if (questTimerInterval) clearInterval(questTimerInterval);
    if (questUpdateInterval) clearInterval(questUpdateInterval);
    if (demoTimerInterval) clearInterval(demoTimerInterval);
    document.getElementById('gameScreen').classList.remove('visible');
    setTimeout(() => { document.getElementById('gameScreen').style.display = 'none'; }, 500);
    document.getElementById('blockedMenu').classList.remove('open');
    setTimeout(() => { document.getElementById('blockedMenu').style.display = 'none'; }, 500);
    document.getElementById('pauseOverlay').style.display = 'none';
    isPaused = false;
    if (isDemo) {
      returnToKey();
    } else {
      document.getElementById('keyContainer').style.display = 'none';
      document.getElementById('keyContainer').style.opacity = '1';
      document.getElementById('keyContainer').style.transform = 'translateY(0)';
      document.getElementById('keyContainer').classList.remove('fade-out');
      document.getElementById('authContainer').style.display = 'block';
      showLogin();
      setTimeout(() => {
        document.getElementById('authContainer').classList.add('fade-in');
      }, 10);
    }
  }

  async function checkAchievements(target) {
    var t = translations[currentLanguage];
    var user;
    if (isDemo && target === 'Demo') {
      user = demoUser;
    } else {
      user = (target === currentUsername) ? userData : await getUser(target);
    }
    var userCount = parseFloat(user.count) || 0;
    var achievements = [
      { threshold: 100, field: 'achieved_100', name: t.achievement100, amount: 100 },
      { threshold: 500, field: 'achieved_500', name: t.achievement500, amount: 500 },
      { threshold: 1000, field: 'achieved_1000', name: t.achievement1000, amount: 1000 },
      { threshold: 3000, field: 'achieved_3000', name: t.achievement3000, amount: 3000 },
      { threshold: 5000, field: 'achieved_5000', name: t.achievement5000, amount: 5000 },
      { threshold: 10000, field: 'achieved_10000', name: t.achievement10000, amount: 10000 }
    ];
    var updates = {};
    achievements.forEach(ach => {
      if (userCount >= ach.threshold && !user[ach.field]) {
        updates[ach.field] = 1;
        if (target === currentUsername) alert(t.achievementUnlocked.replace('{name}', ach.name).replace('{amount}', ach.amount));
      }
    });
    if (Object.keys(updates).length > 0) {
      if (isDemo && target === 'Demo') {
        Object.assign(demoUser, updates);
      } else {
        var uid = (target === currentUsername) ? currentUid : await getUidByUsername(target);
        await update(ref(db, 'users/' + uid), updates);
        if (target === currentUsername) {
          Object.assign(userData, updates);
        }
      }
    }
  }

  function showAchievements() {
    renderAchievements();
    document.getElementById('achievementsMenu').style.display = 'block';
    setTimeout(() => { document.getElementById('achievementsMenu').classList.add('open'); }, 10);
    dragElement(document.getElementById('achievementsMenu'));
  }

  function renderAchievements() {
    var t = translations[currentLanguage];
    var user = getCurrentUser();
    var content = '<h3>' + t.achievementsTitle + '</h3>';
    content += '<p>' + t.achievement100Desc + (user.achieved_100 ? t.achieved : t.notAchieved) + '</p>';
    content += '<p>' + t.achievement500Desc + (user.achieved_500 ? t.achieved : t.notAchieved) + '</p>';
    content += '<p>' + t.achievement1000Desc + (user.achieved_1000 ? t.achieved : t.notAchieved) + '</p>';
    content += '<p>' + t.achievement3000Desc + (user.achieved_3000 ? t.achieved : t.notAchieved) + '</p>';
    content += '<p>' + t.achievement5000Desc + (user.achieved_5000 ? t.achieved : t.notAchieved) + '</p>';
    content += '<p>' + t.achievement10000Desc + (user.achieved_10000 ? t.achieved : t.notAchieved) + '</p>';
    content += '<button onclick="closeAchievements()">' + t.close + '</button>';
    document.getElementById('achievementsMenu').innerHTML = content;
  }

  function closeAchievements() {
    document.getElementById('achievementsMenu').classList.remove('open');
    setTimeout(() => { document.getElementById('achievementsMenu').style.display = 'none'; }, 500);
  }

  function showPromo() {
    var t = translations[currentLanguage];
    if (isDemo) {
      alert(t.promoDisabledInDemo);
      return;
    }
    renderPromo();
    document.getElementById('promoMenu').style.display = 'block';
    setTimeout(() => { document.getElementById('promoMenu').classList.add('open'); }, 10);
    dragElement(document.getElementById('promoMenu'));
  }

  function renderPromo() {
    var t = translations[currentLanguage];
    var content = '<h3>' + t.promoTitle + '</h3>';
    content += '<input id="promoCode" type="text" placeholder="' + t.promoPlaceholder + '" />';
    content += '<br><button onclick="redeemPromo()">' + t.redeem + '</button>';
    content += '<button onclick="closePromo()">' + t.close + '</button>';
    document.getElementById('promoMenu').innerHTML = content;
  }

  function closePromo() {
    document.getElementById('promoMenu').classList.remove('open');
    setTimeout(() => { document.getElementById('promoMenu').style.display = 'none'; }, 500);
  }

  async function redeemPromo() {
    var t = translations[currentLanguage];
    var code = trim(document.getElementById('promoCode').value).toUpperCase();
    var updates = {};
    if (code === 'LYSUKA') {
      updates.has_small_cookie = 1;
      alert(t.promoSmallCookie);
    } else if (code === 'KOT') {
      count += 100;
      updates.count = count;
      updateCounter();
      checkAchievements(currentUsername);
      alert(t.promo100Clicks);
    } else if (code === 'SUKA') {
      updates.has_large_cookie = 1;
      alert(t.promoLargeCookie);
    } else {
      alert(t.invalidPromo);
      return;
    }
    await update(ref(db, 'users/' + currentUid), updates);
    Object.assign(userData, updates);
    closePromo();
  }

  // Console
  function toggleConsole() {
    var consoleMenu = document.getElementById('consoleMenu');
    if (consoleMenu.style.display === 'block') {
      closeConsole();
    } else {
      renderConsole();
      consoleMenu.style.display = 'block';
      setTimeout(() => { consoleMenu.classList.add('open'); }, 10);
      dragElement(consoleMenu);
    }
  }

  function renderConsole() {
    var t = translations[currentLanguage];
    var content = '<h3>' + t.consoleTitle + '</h3>';
    content += '<input id="consoleInput" type="text" placeholder="' + t.consolePlaceholder + '" />';
    content += '<br><button onclick="executeConsoleCommand()">' + t.execute + '</button>';
    content += '<button onclick="closeConsole()">' + t.close + '</button>';
    document.getElementById('consoleMenu').innerHTML = content;
  }

  function closeConsole() {
    var consoleMenu = document.getElementById('consoleMenu');
    consoleMenu.classList.remove('open');
    setTimeout(() => { consoleMenu.style.display = 'none'; }, 500);
  }

  async function executeConsoleCommand() {
    var t = translations[currentLanguage];
    var command = trim(document.getElementById('consoleInput').value).toLowerCase();
    if (command === '') {
      alert(t.enterCommand);
      return;
    }
    var updates = {};
    if (command.startsWith('click:set(')) {
      var match = command.match(/click:set\((\d+)\)/);
      if (match) {
        var amount = parseInt(match[1]);
        if (!isNaN(amount) && amount >= 0) {
          count = amount;
          if (isDemo) {
            demoUser.count = count;
          } else {
            updates.count = count;
            await update(ref(db, 'users/' + currentUid), updates);
            userData.count = count;
          }
          checkAchievements(currentUsername);
          updateCounter();
          alert(t.setClicksSuccess.replace('{amount}', amount));
        } else {
          alert(t.invalidNumber);
        }
      } else {
        alert(t.invalidFormat.replace('{format}', 'click:set(число)'));
      }
    } else if (command === 'give:cookie.small') {
      if (isDemo) {
        demoUser.has_small_cookie = 1;
      } else {
        updates.has_small_cookie = 1;
        await update(ref(db, 'users/' + currentUid), updates);
        userData.has_small_cookie = 1;
      }
      alert(t.gaveSmallCookie);
    } else if (command === 'give:cookie.medium') {
      if (isDemo) {
        demoUser.has_medium_cookie = 1;
      } else {
        updates.has_medium_cookie = 1;
        await update(ref(db, 'users/' + currentUid), updates);
        userData.has_medium_cookie = 1;
      }
      alert(t.gaveMediumCookie);
    } else if (command === 'give:cookie.big') {
      if (isDemo) {
        demoUser.has_large_cookie = 1;
      } else {
        updates.has_large_cookie = 1;
        await update(ref(db, 'users/' + currentUid), updates);
        userData.has_large_cookie = 1;
      }
      alert(t.gaveLargeCookie);
    } else if (command === 'demomode:exit') {
      if (isDemo) {
        closeConsole();
        returnToKey();
        alert(t.exitDemo);
      } else {
        alert(t.notInDemo);
      }
    } else if (command === 'autopasskey') {
      if (document.getElementById('keyContainer').style.display === 'block') {
        document.getElementById('keyContainer').classList.add('fade-out');
        setTimeout(() => {
          document.getElementById('keyContainer').style.display = 'none';
          document.getElementById('authContainer').style.display = 'block';
          setTimeout(() => {
            document.getElementById('authContainer').classList.add('fade-in');
            showRegister();
          }, 10);
        }, 500);
        alert(t.autoPassKey);
      } else {
        alert(t.notInKeyMenu);
      }
    } else if (command.startsWith('demomode:edit_time:set(')) {
      var match = command.match(/demomode:edit_time:set\((.+)\)/);
      if (match) {
        var timeStr = match[1].toLowerCase();
        if (timeStr === 'infinity') {
          if (isDemo) {
            clearInterval(demoTimerInterval);
            isInfiniteDemo = true;
            document.getElementById('demoTimer').innerText = t.demoTimerInfinity;
            alert(t.demoTimeInfinity);
          } else {
            alert(t.notInDemo);
          }
        } else {
          var timeParts = timeStr.split(':');
          if (timeParts.length === 3) {
            var hours = parseInt(timeParts[0]);
            var minutes = parseInt(timeParts[1]);
            var seconds = parseInt(timeParts[2]);
            if (!isNaN(hours) && !isNaN(minutes) && !isNaN(seconds) && hours >= 0 && minutes >= 0 && seconds >= 0) {
              if (isDemo) {
                demoTimeLeft = hours * 3600 + minutes * 60 + seconds;
                if (isInfiniteDemo) {
                  isInfiniteDemo = false;
                  demoTimerInterval = setInterval(updateDemoTimer, 1000);
                }
                updateDemoTimer();
                alert(t.demoTimeSet.replace('{time}', timeStr));
              } else {
                alert(t.notInDemo);
              }
            } else {
              alert(t.invalidTimeFormat);
            }
          } else {
            alert(t.invalidFormat.replace('{format}', 'demomode:edit_time:set(00:00:00) or demomode:edit_time:set(infinity)'));
          }
        }
      } else {
        alert(t.invalidFormat.replace('{format}', 'demomode:edit_time:set(00:00:00) or demomode:edit_time:set(infinity)'));
      }
    } else {
      alert(t.invalidCommand.replace('{command}', command));
    }
    document.getElementById('consoleInput').value = '';
  }

  // Quests
  function showQuests() {
    renderQuests();
    document.getElementById('questsMenu').style.display = 'block';
    setTimeout(() => { document.getElementById('questsMenu').classList.add('open'); }, 10);
    dragElement(document.getElementById('questsMenu'));
  }

  function renderQuests() {
    var t = translations[currentLanguage];
    var user = getCurrentUser();
    var content = '<h3>' + t.questsTitle + '</h3>';
    quests.forEach(function(quest) {
      var isCompleted = user.completed_quests.includes(quest.id);
      var isActive = user.active_quest === quest.id;
      var status = isCompleted ? t.questCompleted : t.questNotCompleted;
      content += '<p>' + status + ' ' + quest.description + ' reward: ' + quest.reward + ' money</p>';
      if (!isCompleted) {
        if (isActive) {
          content += '<button onclick="cancelQuest(' + quest.id + ')">' + t.cancelQuest + '</button>';
        } else {
          content += '<button onclick="takeQuest(' + quest.id + ')">' + t.takeQuest + '</button>';
        }
      }
      content += '<br>';
    });
    content += '<button onclick="closeQuests()">' + t.close + '</button>';
    document.getElementById('questsMenu').innerHTML = content;
  }

  function closeQuests() {
    document.getElementById('questsMenu').classList.remove('open');
    setTimeout(() => { document.getElementById('questsMenu').style.display = 'none'; }, 500);
  }

  async function takeQuest(questId) {
    var t = translations[currentLanguage];
    var user = getCurrentUser();
    if (user.active_quest !== null) {
      alert(t.activeQuest);
      return;
    }
    user.active_quest = questId;
    if (isDemo) {
      demoUser.active_quest = questId;
    } else {
      await update(ref(db, 'users/' + currentUid), { active_quest: questId });
    }
    questStartTime = Date.now();
    questClicks = 0;
    startQuestTimer();
    startQuestUpdateInterval();
    updateCurrentQuest();
    closeQuests();
  }

  async function cancelQuest(questId) {
    var t = translations[currentLanguage];
    var user = getCurrentUser();
    if (user.active_quest === questId) {
      user.active_quest = null;
      if (isDemo) {
        demoUser.active_quest = null;
      } else {
        await update(ref(db, 'users/' + currentUid), { active_quest: null });
      }
      if (questTimerInterval) clearInterval(questTimerInterval);
      if (questUpdateInterval) clearInterval(questUpdateInterval);
      updateCurrentQuest();
      alert(t.questCancelled);
      renderQuests();
    }
  }

  function startQuestTimer() {
    if (questTimerInterval) clearInterval(questTimerInterval);
    questTimerInterval = setInterval(checkQuestCompletion, 1000);
  }

  function startQuestUpdateInterval() {
    if (questUpdateInterval) clearInterval(questUpdateInterval);
    questUpdateInterval = setInterval(updateCurrentQuest, 1000);
  }

  async function checkQuestCompletion() {
    var t = translations[currentLanguage];
    var user = getCurrentUser();
    if (user.active_quest === null) return;
    var quest = quests.find(q => q.id === user.active_quest);
    if (!quest) return;
    var elapsed = (Date.now() - questStartTime) / 1000;
    if (elapsed > quest.timeLimit) {
      alert(t.questTimeExpired);
      user.active_quest = null;
      if (isDemo) {
        demoUser.active_quest = null;
      } else {
        await update(ref(db, 'users/' + currentUid), { active_quest: null });
      }
      if (questTimerInterval) clearInterval(questTimerInterval);
      if (questUpdateInterval) clearInterval(questUpdateInterval);
      updateCurrentQuest();
      return;
    }
    if (questClicks >= quest.clicksRequired) {
      money += quest.reward;
      internal_level += 500;
      if (isDemo) {
        demoUser.money = money;
        demoUser.level = internal_level;
        demoUser.completed_quests.push(quest.id);
        demoUser.active_quest = null;
      } else {
        userData.money = money;
        userData.level = internal_level;
        userData.completed_quests.push(quest.id);
        userData.active_quest = null;
        await update(ref(db, 'users/' + currentUid), {
          money: money,
          level: internal_level,
          completed_quests: userData.completed_quests,
          active_quest: null
        });
      }
      if (questTimerInterval) clearInterval(questTimerInterval);
      if (questUpdateInterval) clearInterval(questUpdateInterval);
      updateMoney();
      updateLevel();
      updateCurrentQuest();
      alert(t.questCompletedSuccess.replace('{reward}', quest.reward));
    }
  }

  function updateCurrentQuest() {
    var t = translations[currentLanguage];
    var user = getCurrentUser();
    if (user.active_quest === null) {
      document.getElementById('currentQuest').innerText = t.currentQuestNone;
    } else {
      var quest = quests.find(q => q.id === user.active_quest);
      var remaining = Math.max(0, quest.timeLimit - Math.floor((Date.now() - questStartTime) / 1000));
      document.getElementById('currentQuest').innerText = t.currentQuest.replace('{clicks}', questClicks).replace('{required}', quest.clicksRequired).replace('{remaining}', remaining);
    }
  }

  // Pause
  function pauseGame() {
    if (isPaused) return;
    isPaused = true;
    pauseStartTime = Date.now();
    var user = getCurrentUser();
    wasQuestActive = (user.active_quest !== null);
    wasDemoTimerActive = (isDemo && !isInfiniteDemo && demoTimerInterval !== null);
    if (questTimerInterval) clearInterval(questTimerInterval);
    if (questUpdateInterval) clearInterval(questUpdateInterval);
    if (wasDemoTimerActive) clearInterval(demoTimerInterval);
    document.getElementById('pauseOverlay').style.display = 'flex';
  }

  function resumeGame() {
    if (!isPaused) return;
    isPaused = false;
    var pauseDuration = Date.now() - pauseStartTime;
    var user = getCurrentUser();
    if (wasQuestActive) {
      questStartTime += pauseDuration;
      startQuestTimer();
      startQuestUpdateInterval();
    }
    if (wasDemoTimerActive) {
      demoTimerInterval = setInterval(updateDemoTimer, 1000);
    }
    document.getElementById('pauseOverlay').style.display = 'none';
  }

  function showSettings() {
    renderSettings();
    document.getElementById('settingsMenu').style.display = 'block';
    setTimeout(() => { document.getElementById('settingsMenu').classList.add('open'); }, 10);
    dragElement(document.getElementById('settingsMenu'));
  }

  function renderSettings() {
    var t = translations[currentLanguage];
    var currentScale = localStorage.getItem('uiScale') || '1';
    var content = '<h3>' + t.settingsTitle + '</h3>';
    content += '<label for="uiScale">' + t.uiScaleLabel + '</label><br>';
    content += '<select id="uiScale">';
    content += '<option value="0.8"' + (currentScale === '0.8' ? ' selected' : '') + '>' + t.smallScale + '</option>';
    content += '<option value="1"' + (currentScale === '1' ? ' selected' : '') + '>' + t.mediumScale + '</option>';
    content += '<option value="1.2"' + (currentScale === '1.2' ? ' selected' : '') + '>' + t.largeScale + '</option>';
    content += '</select><br>';
    content += '<label for="languageSelect">' + t.languageLabel + '</label><br>';
    content += '<select id="languageSelect">';
    content += '<option value="ru"' + (currentLanguage === 'ru' ? ' selected' : '') + '>' + t.russian + '</option>';
    content += '<option value="en"' + (currentLanguage === 'en' ? ' selected' : '') + '>' + t.english + '</option>';
    content += '<option value="uk"' + (currentLanguage === 'uk' ? ' selected' : '') + '>' + t.ukrainian + '</option>';
    content += '</select><br>';
    content += '<button onclick="applySettings()">' + t.apply + '</button><br>';
    content += '<button onclick="closeSettings()">' + t.close + '</button>';
    document.getElementById('settingsMenu').innerHTML = content;
  }

  function applySettings() {
    var scale = document.getElementById('uiScale').value;
    localStorage.setItem('uiScale', scale);
    document.body.style.transform = `scale(${scale})`;
    document.body.style.width = `${100 / parseFloat(scale)}%`;
    document.body.style.height = `${100 / parseFloat(scale)}%`;

    var lang = document.getElementById('languageSelect').value;
    setLanguage(lang);
    closeSettings();
  }

  function closeSettings() {
    document.getElementById('settingsMenu').classList.remove('open');
    setTimeout(() => { document.getElementById('settingsMenu').style.display = 'none'; }, 500);
  }

  // Update quest descriptions
  updateQuestDescriptions();

  window.onbeforeunload = async function() {
    if (currentUsername && !isDemo) {
      await update(ref(db, 'users/' + currentUid), {
        count: count,
        money: money,
        level: internal_level
      });
    }
  };

  // Make all necessary functions global for inline onclick
  window.checkKey = checkKey;
  window.enterDemoMode = enterDemoMode;
  window.showRegister = showRegister;
  window.showLogin = showLogin;
  window.showShop = showShop;
  window.showInventory = showInventory;
  window.showQuests = showQuests;
  window.showAchievements = showAchievements;
  window.showPromo = showPromo;
  window.doLogout = doLogout;
  window.resumeGame = resumeGame;
  window.showSettings = showSettings;
  window.buySmallCookie = buySmallCookie;
  window.buyMediumCookie = buyMediumCookie;
  window.buyLargeCookie = buyLargeCookie;
  window.equipSmallCookie = equipSmallCookie;
  window.unequipSmallCookie = unequipSmallCookie;
  window.equipMediumCookie = equipMediumCookie;
  window.unequipMediumCookie = unequipMediumCookie;
  window.equipLargeCookie = equipLargeCookie;
  window.unequipLargeCookie = unequipLargeCookie;
  window.closeShop = closeShop;
  window.closeInventory = closeInventory;
  window.closeAchievements = closeAchievements;
  window.closePromo = closePromo;
  window.closeQuests = closeQuests;
  window.takeQuest = takeQuest;
  window.cancelQuest = cancelQuest;
  window.showAdminPanel = showAdminPanel;
  window.blockAccount = blockAccount;
  window.unblockAccount = unblockAccount;
  window.resetCount = resetCount;
  window.showIssueClicks = showIssueClicks;
  window.showIssueCookie = showIssueCookie;
  window.showIssueAchievement = showIssueAchievement;
  window.confirmIssueClicks = confirmIssueClicks;
  window.confirmIssueCookie = confirmIssueCookie;
  window.confirmIssueAchievement = confirmIssueAchievement;
  window.closeIssueClicks = closeIssueClicks;
  window.closeIssueCookie = closeIssueCookie;
  window.closeIssueAchievement = closeIssueAchievement;
  window.closeAdminPanel = closeAdminPanel;
  window.toggleConsole = toggleConsole;
  window.executeConsoleCommand = executeConsoleCommand;
  window.closeConsole = closeConsole;
  window.applySettings = applySettings;
  window.closeSettings = closeSettings;
  window.redeemPromo = redeemPromo;
  window.init = init;
  window.pauseGame = pauseGame;
  window.returnToKey = returnToKey;
  window.renderDemoExpired = renderDemoExpired;
  window.showDemoExpired = showDemoExpired;
  window.updateDemoTimer = updateDemoTimer;
  window.showBlocked = showBlocked;
  window.renderBlocked = renderBlocked;
  window.showLoading = showLoading;
  window.formatInternalLevel = formatInternalLevel;
  window.updateQuestDescriptions = updateQuestDescriptions;
  window.checkQuestCompletion = checkQuestCompletion;
  window.startQuestUpdateInterval = startQuestUpdateInterval;
  window.startQuestTimer = startQuestTimer;
  window.updateCurrentQuest = updateCurrentQuest;
  window.renderQuests = renderQuests;
  window.renderConsole = renderConsole;
  window.renderPromo = renderPromo;
  window.renderAchievements = renderAchievements;
  window.renderInventory = renderInventory;
  window.renderShop = renderShop;
  window.updateLevel = updateLevel;
  window.updateMoney = updateMoney;
  window.updateCounter = updateCounter;
  window.updateAllUI = updateAllUI;
  window.setLanguage = setLanguage;
  window.applyStaticTexts = applyStaticTexts;
  window.getUser = getUser;
  window.getTargetUser = getTargetUser;
  window.getUserByUsername = getUserByUsername;
  window.getUidByUsername = getUidByUsername;
  window.showGame = showGame;
  window.trim = trim;
  window.dragElement = dragElement;
  window.isPaused = isPaused; // Note: variables can't be made global like functions, but since it's used internally, it's fine.
  window.questClicks = questClicks; // Same for other variables if needed.
  window.questStartTime = questStartTime;
  window.questTimerInterval = questTimerInterval;
  window.questUpdateInterval = questUpdateInterval;
  window.quests = quests;
  window.demoJustExpired = demoJustExpired;
  window.demoTimeLeft = demoTimeLeft;
  window.demoTimerInterval = demoTimerInterval;
  window.demoUser = demoUser;
  window.isInfiniteDemo = isInfiniteDemo;
  window.wasQuestActive = wasQuestActive;
  window.wasDemoTimerActive = wasDemoTimerActive;
  window.pauseStartTime = pauseStartTime;
  window.keys = keys;
  window.currentLanguage = currentLanguage;
  window.translations = translations;
  window.isDemo = isDemo;
  window.count = count;
  window.money = money;
  window.internal_level = internal_level;
  window.currentUsername = currentUsername;
  window.userData = userData;
  window.currentUid = currentUid;
  window.db = db;
  window.auth = auth;
  window.app = app;
  window.firebaseConfig = firebaseConfig;
</script>
</body>
</html>
